/*!
 Inventario by LivelyWorks - http://livelyworks.net
 version: 1.x
 --------------------------------------------------------------------- 
 Build Timestamp: 1665666018
 Build Date: Thu Oct 13 2022 18:30:18 GMT+0530 (India Standard Time)
--------------------------------------------------------------------- */
!function(){"use strict";angular.module("ManageApp",["ngMessages","ngAnimate","ngSanitize","ui.router","ui.router.state.events","ngNotify","ngDialog","angular-loading-bar","selectize","NgSwitchery","lw.core.utils","lw.security.main","lw.auth","lw.data.datastore","lw.data.datatable","lw.form.main","app.service","app.http","app.notification","app.form","app.directives","app.fileUploader","ui.router.state.events","ManageApp.master","app.UploaderDataService","app.UploaderEngine","ManageApp.ManageUserDataService","ManageApp.users","CommonApp.CommonUserDataService","CommonApp.users","Manage-app.users","ManageApp.UserDataService","ManageApp.ConfigurationDataService","ManageApp.configuration","ManageApp.DashboardDataService","ManageApp.DashboardEngine","app.RolePermissionDataServices","app.RolePermissionEngine","app.ActivityDataServices","app.ActivityEngine","app.CategoryDataServices","app.CategoryEngine","app.CustomerDataServices","app.CustomerEngine","app.SuppliersDataServices","app.SuppliersEngine","app.ProductDataServices","app.ProductEngine","app.LocationDataServices","app.LocationEngine","app.InventoryDataServices","app.InventoryEngine","app.ReportDataServices","app.ReportEngine","app.BillingDataServices","app.BillingEngine","app.TaxPresetDataServices","app.TaxPresetEngine","app.TaxDataServices","app.TaxEngine"]).run(["__Auth","$state","$rootScope","$transitions","$trace",function(o,n,t,e,a){_.delay(function(){o.verifyRoute(n),t.$on("$viewContentLoading",function(t,e){var a=n.current;if(a&&_.has(a,"loginRequired")&&!1===a.loginRequired)return o.isLoggedIn()&&n.go("dashboard"),t.preventDefault(),!1})},100),t.__ngSupport=window.__ngSupport}]).config(["$stateProvider","$urlRouterProvider","$interpolateProvider","$compileProvider",function(t,e,a,o){window.appConfig&&!1===window.appConfig.debug&&o.debugInfoEnabled(!1);a.startSymbol("[["),a.endSymbol("]]"),e.otherwise(function(t,e,a){var o=t.get("$state"),t=(t.get("__Auth"),__globals.appTemps("stateViaRoute"));return!_.has(t,"stateName")||_.isUndefined(t.stateName)||_.isEmpty(t.stateName)?o.go("dashboard"):_.isEmpty(t.stateParams)?o.go(t.stateName):o.go(t.stateName,t.stateParams),e.path()}),t.state("base",{abstract:!0,resolve:{baseData:["$stateParams","BaseDataService",function(t,e){return e.getBaseData("account_logged")}]}}).state("login",__globals.stateConfig("/login","user.login",{parent:"base",loginRequired:!1})).state("forgot_password",__globals.stateConfig("/forgot-password","user.forgot-password",{parent:"base",loginRequired:!1})).state("reset_password",__globals.stateConfig("/reset-password/{reminderToken}","user.reset-password")).state("forgot_password_sucess",__globals.stateConfig("/forgot-password","user.forgot-password-success")).state("home",__globals.stateConfig("/home","home",{access:{authority:"public.app"},parent:"base"})).state("invalid_request",__globals.stateConfig("/invalid-request","errors/invalid-request")).state("not_found",__globals.stateConfig("/not-found","errors.manage-not-exist")).state("not_exist",__globals.stateConfig("/not-exist","errors.manage-not-exist")).state("unauthorized",__globals.stateConfig("/unauthorized","errors.unauthorized")).state("dashboard",__globals.stateConfig("/dashboard","dashboard.admin-dashboard",{controller:"AdminDashboardController as AdminDashboardCtrl",access:{authority:"manage.dashboard.read.support_data"},parent:"base",resolve:{GetDatshboardData:["DashboardDataService",function(t){return t.getSupportData()}]}})).state("users",__globals.stateConfig("/users","user/manage/list",{controller:"ManageUsersController as manageUsersCtrl",access:{authority:"manage.user.read.datatable.list"},parent:"base"})).state("role_permission",__globals.stateConfig("/role-permissions","user/role-permission/list",{access:{authority:"manage.user.role_permission.read.list"},controller:"RolePermissionListController as rolePermissionListCtrl",parent:"base"})).state("profile",__globals.stateConfig("/profile","user/manage-profile",{access:{authority:"user.profile.update"},parent:"base"})).state("profileEdit",__globals.stateConfig("/profile/edit","user/profile-edit",{access:{authority:"user.profile.update.process"},parent:"base"})).state("changePassword",__globals.stateConfig("/change-password","user/change-password",{access:{authority:"user.change_password.process"},parent:"base"})).state("changeEmail",__globals.stateConfig("/change-email","user/change-email",{access:{authority:"user.change_email.process"},parent:"base"})).state("activity_log",__globals.stateConfig("/activity-log","activity/activity-log",{controller:"ActivityLogListController as activityLogListCtrl",parent:"base"})).state("categories",__globals.stateConfig("/categories","category/list",{controller:"CategoryListController as CategoryListCtrl",access:{authority:"manage.category.read.list"},parent:"base"})).state("customer",__globals.stateConfig("/customers","customer/list",{controller:"CustomerListController as customerListCtrl",access:{authority:"manage.customer.read.list"},parent:"base"})).state("suppliers",__globals.stateConfig("/suppliers","suppliers/list",{controller:"SuppliersListController as suppliersListCtrl",access:{authority:"manage.suppliers.read.list"},parent:"base"})).state("product",__globals.stateConfig("/products","product/list",{access:{authority:"manage.product.read.list"},parent:"base",controller:"ProductListController as productListCtrl"})).state("product_add",__globals.stateConfig("/product/add","product/add",{access:{authority:"manage.product.write.create"},parent:"base",controller:"ProductAddController as productAddCtrl",resolve:{productAddData:["ProductDataService",function(t){return t.getAddSupportData()}]}})).state("product_edit",__globals.stateConfig("/product/:productIdOrUid/edit","product/edit",{access:{authority:"manage.product.write.update"},parent:"base",controller:"ProductEditController as productEditCtrl",resolve:{productEditData:["ProductDataService","$stateParams",function(t,e){return t.getEditSupportData(e.productIdOrUid)}]}})).state("location",__globals.stateConfig("/locations","location/list",{access:{authority:"manage.location.read.list"},parent:"base",controller:"LocationListController as locationListCtrl"})).state("inventory",__globals.stateConfig("/inventory","inventory/list",{access:{authority:"manage.inventory.read.list"},parent:"base",controller:"InventoryListController as InventoryListCtrl"})).state("configuration_general",__globals.stateConfig("/general","configuration.general",{parent:"base",controller:"GeneralController as generalCtrl",access:{authority:"manage.configuration.process"},resolve:{getGeneralData:["ConfigurationDataService",function(t){return t.readConfigurationData(1).then(function(t){return t})}]}})).state("configuration_currency",__globals.stateConfig("/currency","configuration.currency",{parent:"base",controller:"CurrencyConfigurationController as currencyConfigurationCtrl",access:{authority:"manage.configuration.process"},resolve:{getCurrencyData:["ConfigurationDataService",function(t){return t.readConfigurationData(2).then(function(t){return t})}]}})).state("report",__globals.stateConfig("/reports","report/list",{access:{authority:"manage.report.read.list"},resolve:{GetSupportData:["ReportDataService",function(t){return t.getSupportData(2)}]},controller:"ReportListController as reportListCtrl",parent:"base"})).state("billing",__globals.stateConfig("/billings","billing/list",{access:{authority:"manage.billing.read.list"},controller:"BillingListController as billingListCtrl",parent:"base"})).state("billing_add",__globals.stateConfig("/billing/create","billing/add",{access:{authority:"manage.billing.read.list"},resolve:{GetAddSupportData:["BillingDataService",function(t){return t.getAddSupportData()}]},controller:"BillingAddController as billingAddCtrl",parent:"base"})).state("billing_edit",__globals.stateConfig("/billing/:billUid/edit","billing/edit",{access:{authority:"manage.billing.read.list"},resolve:{GetEditSupportData:["BillingDataService","$stateParams",function(t,e){return t.getEditSupportData(e.billUid)}]},controller:"BillingEditController as billingEditCtrl",parent:"base"})).state("billing_details",__globals.stateConfig("/billing/:billUid/details","billing/details",{access:{authority:"manage.billing.read.list"},resolve:{GetEditSupportData:["BillingDataService","$stateParams",function(t,e){return t.getDetailsSupportData(e.billUid)}]},controller:"BillingDetailsController as billingDetailsCtrl",parent:"base"})).state("tax_preset",__globals.stateConfig("/tax-presets","tax-preset/list",{access:{},controller:"TaxpresetListController as taxpresetListCtrl",parent:"base"})).state("tax",__globals.stateConfig("/tax-preset/:taxPresetIdOrUid/taxes","tax/list",{access:{},controller:"TaxListController as taxListCtrl",parent:"base"}))}])}(),function(){"use strict";angular.module("ManageApp.master",[]).controller("ManageController",["$rootScope","__DataStore","$scope","__Auth","appServices","appNotify","__Form","$state","appToastNotify","ConfigurationDataService",function(a,o,t,e,n,i,r,s,l,c){var u=this;u.pageStatus=!1,u.refreshAuthObj=function(){e.refresh(function(t){u.auth_info=t})},u.refreshAuthObj(),u.notify=__globals.getAppImmutables("notifyToAdmin"),u.restrict_user_email_update=__globals.getAppImmutables("restrict_user_email_update"),u.unhandledError=function(){i.error(__globals.getReactionMessage(19))},a.isAdmin=function(){return 1===u.auth_info.designation},a.$on("auth_info_updated",function(t,e){a.auth_info=e.auth_info,_.isEmpty(e.userFullName)||(u.userUpdateData=e.userFullName),u.auth_info=a.auth_info}),a.$on("lw.events.logged_in_user",function(){u.refreshAuthObj()}),a.$on("lw.events.state.change_start",function(){n.closeAllDialog()}),a.$on("lw.datastore.event.post.started",__globals.showButtonLoader),a.$on("lw.datastore.event.fetch.started",__globals.showFormLoader),a.$on("lw.form.event.process.started"),a.$on("lw.form.event.fetch.started",__globals.showFormLoader),a.$on("lw.datastore.event.fetch.finished",__globals.hideFormLoader),a.$on("lw.datastore.event.post.finished",__globals.hideButtonLoader),a.$on("lw.form.event.process.finished",__globals.hideButtonLoader),a.$on("lw.datastore.event.fetch.error",u.unhandledError),a.$on("lw.form.event.process.error",u.unhandledError),a.$on("$stateChangeSuccess",function(t,e){var a=__globals.getScrollOffsets(),a=Math.round(a.y);$("html, body").animate({scrollTop:0},a<500?500:a)}),a.$on("ngDialog.opened",function(t,e){_.defer(function(){$(".ngdialog").scrollTop(0)})}),u.showUploadManagerDialog=function(){n.showDialog(u,{templateUrl:__globals.getTemplateURL("upload-manager.upload-manager-dialog")},function(t){})},u.isLoggedIn=function(){return e.isLoggedIn()},u.logoutUser=function(){e.registerIntended("dashboard"),o.post({apiURL:"user.logout"}).success(function(t){1==t.reaction&&e.checkOut({},function(t){s.go("login")})})},u.openHelpDailog=function(t,e){u.templateTitle=e,n.showDialog(u,{templateUrl:__globals.getTemplateURL(t),controller:"HelpController as helpCtrl"},function(t){})},u.showGeneralSetting=function(){c.readConfigurationData(1).then(function(t){var e=t.data.configuration.logo_background_color;n.showDialog({responseData:t},{templateUrl:__globals.getTemplateURL("configuration.general")},function(t){$("#lwchangeBgHeaderColor").css("background","#"+e)})})},u.themeColors=__globals.getAppImmutables("config").theme_colors,u.setThemeColor=function(t){o.fetch({apiURL:"theme_color",colorName:t}).success(function(t){location.reload()})},u.showHideThemeContainer=function(){$(".lw-theme-color-container").hasClass("lw-theme-container-active")?($(".lw-theme-color-container").removeClass("lw-theme-container-active"),$(".lw-switch span:first").replaceWith("<i class='fa fa-cog'></i>")):($(".lw-theme-color-container").addClass("lw-theme-container-active"),$(".lw-switch i:first").replaceWith("<span>&times;</span>"))},a.$on("lw-open-login-dialog",function(t,e){t.preventDefault(),n.loginRequiredDialog("login-dialog",e.data,function(t,e){o.reset(),t&&(u.refreshAuthObj(),s.reload())})})}]).controller("HelpController",["$rootScope","$scope",function(t,e){_.has(e.ngDialogData,"templateTitle")&&(this.templateTitle=e.ngDialogData.templateTitle);this.closeDialog=function(){e.closeThisDialog()}}])}(),function(){"use strict";window.angular.module("ManageApp.ManageUserDataService",[]).service("ManageUserDataService",["$q","__DataStore","__Form","appServices",function(e,o,t,n){this.getUserInfo=function(t){var a=e.defer();return o.fetch({apiURL:"manage.user.read.info",userId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e)})}),a.promise},this.getUserAddSupportData=function(){var a=e.defer();return o.fetch("manage.user.read.create.support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e)})}),a.promise},this.getUserPermissions=function(t){var a=e.defer();return o.fetch({apiURL:"manage.user.read.get_user_permissions",userId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getUserDetailData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.user.read.detail.data",userID:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getUserEditData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.user.read.edit_suppport_data",userId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("ManageApp.users",[]).controller("ManageUsersController",["$scope","__DataStore","appServices","ManageUserDataService","ConfigurationDataService","LocationDataService",function(a,o,n,i,t,r){var s=[{name:null,template:"#profileImageColumnTemplate"},{name:"name",template:"#userNameColumnTemplate",orderable:!0},{name:"username",orderable:!0},{name:"email",orderable:!0},{name:"updated_at",template:"#userUpdatedDateColumnTemplate",orderable:!0},{name:"user_role",orderable:!0},{name:null,template:"#userActionColumnTemplate"}],l=[{name:null,template:"#profileImageColumnTemplate"},{name:"name",template:"#userNameColumnTemplate",orderable:!0},{name:"username",orderable:!0},{name:"email",orderable:!0},{name:"updated_at",template:"#userUpdatedDateColumnTemplate",orderable:!0},{name:"user_role",orderable:!0},{name:null,template:"#userActionColumnTemplate"}],e={active:{id:"activeUsersTabList",status:1},inactive:{id:"inactiveUsersTabList",status:2},deleted:{id:"deletedUsersTabList",status:5}},c=1,u=this;$("#manageUsersTabs a").click(function(t){t.preventDefault();t=$(this).attr("aria-controls"),t=e[t];_.isEmpty(t)||($(this).tab("show"),c=t.status,u.getUsers(t.id,t.status))}),u.getUsers=function(t,e){u.usersListDataTable&&u.usersListDataTable.destroy(),u.usersListDataTable=o.dataTable("#"+t,{url:{apiURL:"manage.user.read.datatable.list",status:e},dtOptions:{searching:!0,pageLength:25,order:[[1,"asc"]]},columnsData:5==e?l:s,scope:a})},u.getUsers("activeUsersTabList",1),u.reloadDT=function(){o.reloadDT(u.usersListDataTable)},u.delete=function(t,e,a){u.deletingUserName=unescape(e),_.defer(function(){var t=$("#lwUserDeleteConfirmTextMsg"),e=$("#lwUserPerDeleteConfirmTextMsg");1==a?(u.deleteText=t.attr("data-message"),u.deleteConfirmBtnText=t.attr("data-delete-button-text"),u.successMsgText=t.attr("success-msg")):(u.deleteText=e.attr("data-message"),u.deleteConfirmBtnText=e.attr("data-delete-button-text"),u.successMsgText=e.attr("success-msg"))}),_.defer(function(){__globals.showConfirmation({html:u.deleteText,confirmButtonText:u.deleteConfirmBtnText},function(){o.post({apiURL:"manage.user.write.delete",userID:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(){__globals.showConfirmation({title:"Deleted!",text:e,type:"error"})}},function(){__globals.showConfirmation({title:"Deleted!",text:u.successMsgText,type:"success"}),u.reloadDT()})})})})},u.restore=function(e,t){u.restoringUserName=unescape(t),_.defer(function(){var t=$("#lwUserRestoreConfirmTextMsg");__globals.showConfirmation({text:t.attr("data-message"),confirmButtonText:t.attr("data-restore-button-text")},function(){o.post({apiURL:"manage.user.write.restore",userID:e}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(){__globals.showConfirmation({title:"Restore!",text:e,type:"error"})}},function(){__globals.showConfirmation({title:"Restore!",text:e,type:"success"}),u.reloadDT()})})})})},u.changePassword=function(t,e){n.showDialog({userID:t,name:unescape(e)},{templateUrl:__globals.getTemplateURL("user.manage.change-password"),controller:"ManageUserChangePasswordController as userChangePassword"},function(t){})},u.showAddNewDialog=function(){n.showDialog({showRoleSelectBox:!0},{templateUrl:__globals.getTemplateURL("user.manage.add-dialog")},function(t){_.has(t.value,"user_added")&&1==t.value.user_added&&1==c&&u.reloadDT()})},u.editUserDialog=function(t,e){n.showDialog({userId:t,name:e},{templateUrl:"user.manage.edit-dialog",controller:"EditUserDialogController as EditUserDialogCtrl",resolve:{EditUserData:function(){return i.getUserEditData(t)}}},function(t){_.has(t.value,"user_updated")&&1==t.value.user_updated&&u.reloadDT()})},u.showUsersConfigurationDialog=function(){t.readConfigurationData(5).then(function(t){n.showDialog({responseData:t},{templateUrl:__globals.getTemplateURL("configuration.users")},function(t){})})},u.usersPermissionDialog=function(t,e){n.showDialog({userId:t,fullName:_.unescape(e)},{templateUrl:__globals.getTemplateURL("user.manage.user-dynamic-permission"),controller:"ManageUsersDynamicPermissionController as manageUsersDynamicPermissionCtrl",resolve:{UserPermission:function(){return i.getUserPermissions(t)}}},function(t){})},u.openUserDetailsDialog=function(t){n.showDialog({},{templateUrl:__globals.getTemplateURL("user.manage.user-detail-dialog"),controller:"ManageUsersDetailController as manageUsersDetailCtrl",resolve:{UserDetailData:function(){return i.getUserDetailData(t)}}},function(t){})},u.showAssignLocationDialog=function(t,e){n.showDialog({userAuthorityId:t,name:unescape(e)},{templateUrl:__globals.getTemplateURL("location.assign-location-dialog"),controller:"AssignLocationController as AssignLocationCtrl",resolve:{assignLocationData:function(){return r.getAssignLocationData(t)}}},function(t){})}}]).controller("ManageUsersDetailController",["$scope","__DataStore","__Form","$stateParams","appServices","UserDetailData",function(t,e,a,o,n,i){this.userData=i.userData,this.closeDialog=function(){t.closeThisDialog()}}]).controller("AddUserDialogController",["$scope","__Form","appServices","ManageUserDataService",function(e,t,a,o){var n=this;(n=t.setup(n,"add_user_form","userData",{secured:!0})).showRoleSelectBox=e.ngDialogData.showRoleSelectBox,o.getUserAddSupportData().then(function(t){t=t.data;n.userRoles=t.userRoles}),n.submit=function(){t.process("manage.user.write.create",n).success(function(t){a.processResponse(t,null,function(){e.closeThisDialog({user_added:!0,user_data:t.data.userData})})})},n.closeDialog=function(){e.closeThisDialog()}}]).controller("ManageUserChangePasswordController",["$scope","__Form","appServices",function(e,t,a){var o=this;(o=t.setup(o,"change_password_form","changePasswordData",{secured:!0})).ngDialogData=e.ngDialogData,o.title=unescape(o.ngDialogData.name),o.userID=o.ngDialogData.userID,o.submit=function(){t.process({apiURL:"manage.user.write.change_password.process",userID:o.userID},o).success(function(t){a.processResponse(t,null,function(){e.closeThisDialog()})})},o.closeDialog=function(){e.closeThisDialog()}}]).controller("ManageUserDetailsDialog",["$scope",function(t){this.ngDialogData=t.ngDialogData,this.userDetails=this.ngDialogData,this.closeDialog=function(){t.closeThisDialog()}}]).controller("ManageUsersDynamicPermissionController",["$scope","__Form","__DataStore","appServices","UserPermission",function(e,t,a,o,n){var i=this;(i=t.setup(i,"user_dynamic_access","accessData",{secured:!0,unsecuredFields:[]})).ngDialogData=e.ngDialogData,i.userId=i.ngDialogData.userId,i.fullName=i.ngDialogData.fullName,i.requestData=n,i.permissions=i.requestData.permissions,i.accessData.allow_permissions=i.requestData.allow_permissions,i.accessData.deny_permissions=i.requestData.deny_permissions,i.accessData.inherit_permissions=i.requestData.inherit_permissions,i.disablePermissions=function(t,a){_.map(t.children,function(e){_.includes(e.dependencies,a)&&_.delay(function(t){$('input[name="'+e.id+'"]').attr("disabled",!0)},500)})},i.checkedPermission={},_.map(i.accessData.allow_permissions,function(t){i.checkedPermission[t]="2"}),_.map(i.accessData.deny_permissions,function(a){i.checkedPermission[a]="3",_.map(i.permissions,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&i.disablePermissions(t,a),_.has(t,"children_permission_group")&&_.map(t.children_permission_group,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&i.disablePermissions(t,a)})})}),_.map(i.accessData.inherit_permissions,function(a){i.checkedPermission[a]="1",_.map(i.permissions,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&0==t.children[0].inheritStatus&&"1"==t.children[0].result&&i.disablePermissions(t,a),_.has(t,"children_permission_group")&&_.map(t.children_permission_group,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&0==t.children[0].inheritStatus&&"1"==t.children[0].result&&i.disablePermissions(t,a)})})}),i.checkPermission=function(a,o){_.isString(o)||(o=o.toString()),"2"==(i.checkedPermission[a]=o)?(_.includes(i.accessData.allow_permissions,a)||i.accessData.allow_permissions.push(a),_.includes(i.accessData.deny_permissions,a)&&(i.accessData.deny_permissions=_.without(i.accessData.deny_permissions,a))):("3"==o?_.includes(i.accessData.deny_permissions,a)||i.accessData.deny_permissions.push(a):_.includes(i.accessData.deny_permissions,a)&&(i.accessData.deny_permissions=_.without(i.accessData.deny_permissions,a)),_.includes(i.accessData.allow_permissions,a)&&(i.accessData.allow_permissions=_.without(i.accessData.allow_permissions,a))),_.map(i.permissions,function(e){var t=_.pluck(e.children,"id");_.includes(t,a)&&e.children[0].id==a&&_.map(e.children,function(t){_.includes(t.dependencies,a)&&"3"==o||_.includes(t.dependencies,a)&&"1"==o&&e.children[0].result&&0==e.children[0].inheritStatus?$('input[name="'+t.id+'"]').attr("disabled",!0):$('input[name="'+t.id+'"]').attr("disabled",!1)}),_.has(e,"children_permission_group")&&_.map(e.children_permission_group,function(e){var t=_.pluck(e.children,"id");_.includes(t,a)&&e.children[0].id==a&&_.map(e.children,function(t){_.includes(t.dependencies,a)&&"3"==o||_.includes(t.dependencies,a)&&"1"==o&&e.children[0].result&&0==e.children[0].inheritStatus?$('input[name="'+t.id+'"]').attr("disabled",!0):$('input[name="'+t.id+'"]').attr("disabled",!1)})})})},i.submit=function(){t.process({apiURL:"manage.user.write.user_dynamic_permission",userId:i.userId},i).success(function(t){o.processResponse(t,null,function(){e.closeThisDialog()})})},i.closeDialog=function(){e.closeThisDialog()}}]).controller("EditUserDialogController",["$scope","__DataStore","__Form","$stateParams","appServices","EditUserData",function(e,t,a,o,n,i){var r=this,s=e.ngDialogData;r.userRoles=i.userRoles,r=a.setup(r,"user_edit_form","userData"),(r=a.updateModel(r,i.userUpdateData)).submit=function(){a.process({apiURL:"manage.user.write.update_process",userId:s.userId},r).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({user_updated:!0})})})},r.closeDialog=function(){e.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("ManageApp.UserDataService",[]).service("UserDataService",["$q","__DataStore","__Form","appServices",function(t,e,o,n){this.getLoginAttempts=function(){var a=t.defer();return o.fetch("user.login.attempts").success(function(e){n.processResponse(e,null,function(t){a.resolve(e)})}),a.promise},this.getCountries=function(){var a=t.defer();return e.fetch("user.get.country_list").success(function(e){n.processResponse(e,null,function(t){a.resolve(e)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("Manage-app.users",[]).controller("UserLoginController",["__Form","__Auth","appServices","__Utils","UserDataService","$state","$rootScope",function(t,a,o,e,n,i,r){var s=this;(s=t.setup(s,"form_user_login","loginData",{secured:!0})).show_captcha=!1,s.request_completed=!1,n.getLoginAttempts().then(function(t){s.show_captcha=t.data.show_captcha,s.site_key=t.data.site_key,s.request_completed=!0}),s.getCaptchaURL=function(){return e.apiURL("security.captcha")+"?ver="+Math.random()},s.refreshCaptcha=function(){s.captchaURL=s.getCaptchaURL()},s.captchaURL=s.getCaptchaURL(),s.redirectToIntended=function(){return __globals.intended&&__globals.intended.name&&__globals.intended.params?i.go(__globals.intended.name,__globals.intended.params):__globals.intended&&__globals.intended.name?i.go(__globals.intended.name):i.go("dashboard")},s.submit=function(){s.isInActive=!1,s.accountDeleted=!1,t.process("user.login.process",s).success(function(t){var e=t.data;1!=t.reaction&&(s[s.ngFormModelName].recaptcha=null),o.processResponse(t,{error:function(){s.show_captcha=e.show_captcha,s[s.ngFormModelName].password="",s.show_captcha&&(s[s.ngFormModelName].confirmation_code="",s.refreshCaptcha())},otherError:function(t){s.isInActive=e.isInActive,s.accountDeleted=e.accountDeleted,3==t&&s.show_captcha&&s.refreshCaptcha(),10==t&&s.redirectToIntended()}},function(){a.checkIn(e.auth_info,function(){e.availableRoutes&&__globals.appImmutable("availableRoutes",e.availableRoutes),e.ckeditor&&__globals.appImmutable("ckeditor",e.ckeditor),e.intendedUrl?__globals.redirectBrowser(e.intendedUrl):(r.$emit("lw.events.logged_in_user",{data:!0}),s.redirectToIntended())})})})}}]).controller("UserLogoutController",["__DataStore","__Auth","appServices",function(t,a,o){t.post("user.logout").success(function(e){o.processResponse(e,function(t){a.checkIn(e.data.auth_info)})})}]).controller("UserForgotPasswordController",["__Form","appServices","__Utils","$state",function(t,e,a,o){var n=this;(n=t.setup(n,"user_forgot_password_form","userData",{secured:!0})).submit=function(){t.process("user.forgot_password.process",n).success(function(t){e.processResponse(t,null,function(){o.go("forgot_password_sucess")})})}}]).controller("UserResetPasswordController",["__Form","appServices","__Utils","$state",function(t,e,a,o){var n=this;(n=t.setup(n,"user_reset_password_form","userData",{secured:!0})).submit=function(){t.process({apiURL:"user.reset_password.process",reminderToken:o.params.reminderToken},n).success(function(t){e.processResponse(t,null,function(t){o.go("login")})})}}]).controller("UserContactController",["__Form","$state","appServices","__Utils","__Auth","$scope",function(e,t,a,o,n,i){var r=this;r.showCaptcha=!1,(r=e.setup(r,"user_contact_form","userData",{secured:!0,unsecuredFields:["message"]})).AdditionalOptionOfCkeditor={toolbar:[{name:"links",items:["Link","Unlink","Anchor"]},{name:"insert",items:["Smiley"]}],extraPlugins:"smiley"},n.refresh(function(t){r.auth_info=t}),r.isLoggedIn=r.auth_info.authorized,r.isLoggedIn||(r.showCaptcha=!0),9!=r.auth_info.reaction_code&&(r.userData.email=r.auth_info.profile.email,r.userData.name=r.auth_info.profile.full_name),_.isEmpty(i.ngDialogData)||(r.userData.orderUID=i.ngDialogData.orderUID),r.getCaptchaURL=function(){return o.apiURL("security.captcha")+"?ver="+Math.random()},r.refreshCaptcha=function(){r.captchaURL=r.getCaptchaURL()},r.captchaURL=r.getCaptchaURL(),r.requestSuccess=!1,r.submit=function(t){r.userData.formType=t,e.process("user.contact.process",r).success(function(t){a.processResponse(t,{error:function(){},otherError:function(){r[r.ngFormModelName].confirmation_code="",r.refreshCaptcha()}},function(){r.userData="",CKEDITOR.instances.message.setData(""),2==r.userData.formType&&i.closeThisDialog(),r.requestSuccess=!0,$(".lw-contact-form").slideUp()})})},r.closeDialog=function(){i.closeThisDialog()}}]).controller("UserAddCountryController",["$scope","__Form","$state","appServices","__Utils","UserDataService",function(e,t,a,o,n,i){var r=this;(r=t.setup(r,"user_country_add_form","userData")).request_completed=!1,r.countries=[],i.getCountries().then(function(t){t=t.data;r.countries=t.countries,r.request_completed=!0}),r.countrySelectConfig=__globals.getSelectizeOptions(),r.submit=function(){t.process("user.add.country.process",r).success(function(t){o.processResponse(t,null,function(){e.closeThisDialog({countryAdded:!0})})})},r.close=function(){e.closeThisDialog({countryAdded:!1})}}])}(window),function(){"use strict";window.angular.module("ManageApp.ConfigurationDataService",[]).service("ConfigurationDataService",["$q","__DataStore","appServices",function(e,o,n){this.readConfigurationData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.configuration.get.support.data",formType:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("ManageApp.configuration",[]).controller("GeneralController",["$scope","__Form","$state","appServices","lwFileUploader","__Utils","$rootScope","getGeneralData",function(a,t,e,o,n,i,r,s){var l=this,c=((l=t.setup(l,"general_edit","editData",{secured:!0,modelUpdateWatcher:!0,unsecuredFields:["logoURL","faviconURL","smallLogoURL"]})).pageStatus=!1,l.timezone_select_config=__globals.getSelectizeOptions({valueField:"value",labelField:"text",searchField:["text"]}),l.home_page_select_config=__globals.getSelectizeOptions({valueField:"id"}),l.checkLogo=function(t){var e=!1;(e=l.editData.invoice_logo_image==l.editData.logo_image?!0:e)&&(1==t?l.editData.invoice_logo_image="":2==t&&(l.editData.logo_image=""))},s.data),c=(l.timezoneData=c.configuration.timezone_list,l.homePageData=__globals.generateKeyValueItems(c.configuration.home_page_list),l.languages=c.configuration.locale_list,c.configuration);t.updateModel(l,c),l.pageStatus=!0,l.imagesSelectConfig=__globals.getSelectizeOptions({valueField:"name",labelField:"name",render:{item:function(t,e){return i.template("#imageListItemTemplate",t)},option:function(t,e){return i.template("#imageListOptionTemplate",t)}},searchField:["name"]}),l.retrieveSpecificFiles=function(){n.getTempUploadedFiles(l,{url:i.apiURL("media.upload.read_logo")},function(t){l.logoFiles=t,l.logoFilesCount=t.length})},l.retrieveSpecificFiles(),l.retrieveFaviconFiles=function(){n.getTempUploadedFiles(l,{url:i.apiURL("media.upload.read_favicon")},function(t){l.faviconFiles=t,l.faviconFilesCount=t.length})},l.retrieveFaviconFiles(),r.$on("lw-loader-event-start",function(t,e){a.loading=!0,$("#lwFileupload").attr("disabled",!0)}),r.$on("lw-loader-event-stop",function(t,e){a.loading=!1,$("#lwFileupload").attr("disabled",!1)}),a.upload=function(){n.upload({url:i.apiURL("media.upload.write.logo")},function(t){l.retrieveSpecificFiles(),l.retrieveFaviconFiles()})},a.showUploadedMediaDialog=function(){n.openDialog(l,{url:i.apiURL("media.upload.read_logo")},function(t){l.retrieveSpecificFiles(),l.retrieveFaviconFiles()})},l.submit=function(){t.process({apiURL:"manage.configuration.process",formType:1},l).success(function(t){o.processResponse(t,null,function(){1==t.data.showRealodButton&&__globals.showConfirmation({title:t.data.message,text:t.data.textMessage,type:"success",confirmButtonClass:"btn-success",confirmButtonText:$("#lwReloadBtnText").attr("data-message"),confirmButtonColor:"#337ab7"},function(){location.reload()})})})},s.data.configuration.logo_background_color;l.closeDialog=function(){a.closeThisDialog()}}]).controller("CurrencyConfigurationController",["$scope","__Form","appServices","getCurrencyData",function(t,e,a,o){var n=this,o=(t.ngDialogData,n.isZeroDecimalCurrency=!1,n.generateCurrenciesArray=function(t,e){var a;return e?(a=[],_.forEach(t,function(t,e){a.push({currency_code:e,currency_name:t.name})}),e=$("#lwCurrencySettingTxtMsg"),a.push({currency_code:"other",currency_name:e.attr("other-text")}),a):t},n.checkIsZeroDecimalCurrency=function(t,a){t=_.filter(t,function(t,e){return e===a});n.isZeroDecimalCurrency=Boolean(t.length)},n.checkIsPaypalSupported=function(a){var t=_.filter(n.options,function(t,e){return e==a});n.isPaypalSupport=Boolean(t.length)},n.formatCurrency=function(e,a){_.defer(function(){var t=$("#lwCurrencyFormat").attr("data-format");n.currency_format_preview=t.split("{__currencySymbol__}").join(e).split("{__amount__}").join(100).split("{__currencyCode__}").join(a)})},n.pageStatus=!1,(n=e.setup(n,"edit_currency_configuration","editData",{secured:!0,unsecuredFields:["currency_symbol","currency_format"]})).currencies_select_config=__globals.getSelectizeOptions({valueField:"currency_code",labelField:"currency_name",searchField:["currency_code","currency_name"]}),n.multi_currencies_select_config=__globals.getSelectizeOptions({valueField:"currency_code",labelField:"currency_name",searchField:["currency_code","currency_name"],plugins:["remove_button"],maxItems:1e3,delimiter:",",persist:!1}),n.is_support_paypal=!0,o.data),i=o.configuration.currencies;n.options=i.options,n.currencies=i.details,n.zeroDecimal=i.zero_decimal,_.defer(function(){n.currencies_options=n.generateCurrenciesArray(i.details,!0)}),n.checkIsZeroDecimalCurrency(n.zeroDecimal,o.configuration.currency_value),n.checkIsPaypalSupported(o.configuration.currency),n.default_currency_format=o.configuration.default_currency_format,n.placeholders=o.placeholders,n=e.updateModel(n,o.configuration),_.forEach(n.currencies,function(t,e){e==n.editData.currency_value&&(n.currencySymbol=t.symbol)}),"other"==o.configuration.currency&&(n.currencySymbol=o.configuration.currency_symbol),n.formatCurrency(n.currencySymbol,n.editData.currency_value),n.pageStatus=!0,n.useDefaultFormat=function(t,e,a){n.editData.currency_format=t;t=n.editData.currency_format;n.currency_format_preview=t.split("{__currencySymbol__}").join(e).split("{__amount__}").join(100).split("{__currencyCode__}").join(a)},n.updateCurrencyPreview=function(t,e){_.isUndefined(t)&&(t=""),_.isUndefined(e)&&(e="");var a=$("#lwCurrencyFormat").attr("data-format");n.currency_format_preview=a.split("{__currencySymbol__}").join(t).split("{__amount__}").join(100).split("{__currencyCode__}").join(e)},n.submit=function(){e.process({apiURL:"manage.configuration.process",formType:2},n).success(function(t){a.processResponse(t,null,function(){1==t.data.showRealodButton&&__globals.showConfirmation({title:t.data.message,text:t.data.textMessage,type:"success",showCancelButton:!0,confirmButtonClass:"btn-success",confirmButtonText:$("#lwReloadBtnText").attr("data-message"),confirmButtonColor:"#337ab7"},function(){location.reload()})})})},n.currencyChange=function(a){n.checkIsZeroDecimalCurrency(n.zeroDecimal,a),_.isEmpty(a)||"other"==a?(n.editData.currency_value="",n.editData.currency_symbol=""):(_.forEach(n.currencies,function(t,e){e==a&&(n.editData.currency_value=a,n.editData.currency_symbol=t.ASCII,n.currencySymbol=t.symbol)}),n.is_support_paypal=!0),n.updateCurrencyPreview(n.currencySymbol,n.editData.currency_value),n.checkIsPaypalSupported(n.editData.currency_value)},n.currencyValueChange=function(a){var o;n.checkIsZeroDecimalCurrency(n.zeroDecimal,a),_.isEmpty(a)||"other"==a?_.isEmpty(a)?n.editData.currency="":n.editData.currency="other":(o={},_.forEach(n.currencies,function(t,e){e==a&&(o=t)}),_.isEmpty(o)?n.editData.currency="other":(n.editData.currency=a,n.editData.currency_symbol=o.ASCII,n.currencySymbol=o.symbol)),n.checkIsPaypalSupported(a),_.isUndefined(n.editData.currency_value)&&(n.currencySymbol=""),n.updateCurrencyPreview(n.currencySymbol,n.editData.currency_value)},n.closeDialog=function(){t.closeThisDialog(n.currencySymbol,n.editData.currency)}}])}(window),function(){"use strict";window.angular.module("ManageApp.DashboardDataService",[]).service("DashboardDataService",["$q","__DataStore","appServices",function(e,o,n){this.getSupportData=function(t){var a=e.defer();return o.fetch("manage.dashboard.read.support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getProductSearchData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.dashboard.read.search_products",searchTerm:t},{fresh:!0}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e)})}),a.promise},this.getProductInventoryDetails=function(t){var a=e.defer();return o.fetch({apiURL:"manage.dashboard.read.product_inventory_details",productId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("ManageApp.DashboardEngine",[]).controller("AdminDashboardController",["$scope","GetDatshboardData","$rootScope","appServices","DashboardDataService","InventoryDataService","__Utils","$compile",function(t,e,a,r,o,s,n,i){var l=this;l.pageStatus=!1,l.dashboardData=e.dashboard.dashboardData,l.myLocations=l.dashboardData.myLocations,l.isAdmin=l.dashboardData.isAdmin,l.options=[],$.typeahead({input:".lw-product-search-input",minLength:1,order:"asc",dynamic:!0,delay:500,hint:!1,searchOnFocus:!1,emptyTemplate:"no result found for '{{query}}' ",template:function(t,e){return"<span><span>{{product_name}}</span> <span>{{name}}</span></span>"},source:{productList:{display:["product_name","name","barcode","location_name"],ajax:function(t,e){return{type:"GET",path:"productList",url:n.apiURL({apiURL:"manage.dashboard.read.search_products",searchTerm:t}),callback:{done:function(t){return l.options=t.data.productList,t.data}}}}}},callback:{onClick:function(t,e,a,o){o.preventDefault(),_.isEmpty(a)||l.updateInventory(a.id,null,null)}},debug:!0}),l.updateInventory=function(e,t,a){var o=null,n=null,i=null;if(_.forEach(l.options,function(t){t.id==e&&(o=t.product_id,n=t.product_name,i=t.supplier_id)}),_.isUndefined(e))return!1;r.showDialog({productName:n,productId:o,type:a,combinationId:parseInt(e),supplierId:i,showProductList:!1},{templateUrl:"inventory.update-inventory-dialog",controller:"UpdateInventoryController as UpdateInventoryCtrl",resolve:{InventoryUpdateData:function(){return s.getInventoryUpdateData(o,e,t,i)}}},function(t){_.has(t.value,"inventory_updated")&&t.value.inventory_updated})}}]).controller("InventoryDetailController",["$scope","__DataStore","__Form","$stateParams","InventoryDataService","appServices","DashboardDataService",function(t,e,a,o,r,s,n){var l=this;l.initialContentLoaded=!1,l.getproductInventoryDetails=function(){n.getProductInventoryDetails(t.ngDialogData.productId).then(function(t){l.inventoryData=t.invetoryData,l.initialContentLoaded=!0})},l.getproductInventoryDetails(),l.updateInventory=function(t,e,a,o,n,i){s.showDialog({productName:e,productId:t,type:n},{templateUrl:"inventory.update-inventory-dialog",controller:"UpdateInventoryController as UpdateInventoryCtrl",resolve:{InventoryUpdateData:function(){return r.getInventoryUpdateData(t,a,o,i)}}},function(t){_.has(t.value,"inventory_updated")&&t.value.inventory_updated&&l.getproductInventoryDetails()})},l.closeDialog=function(){t.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.RolePermissionDataServices",[]).service("RolePermissionDataService",["$q","__DataStore","appServices",function(e,o,n){this.getPermissions=function(t){var a=e.defer();return o.fetch({apiURL:"manage.user.role_permission.read",roleId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getAddSupportData=function(){var a=e.defer();return o.fetch("manage.user.role_permission.read.add_support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getAllPermissionsById=function(t){var a=e.defer();return o.fetch({apiURL:"manage.user.role_permission.read.using_id",roleId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.RolePermissionEngine",[]).controller("RolePermissionController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("RolePermissionListController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","RolePermissionDataService",function(t,o,e,a,n,i,r){var s=this;s.rolePermissionDataTable=o.dataTable("#lwrolePermissionList",{url:"manage.user.role_permission.read.list",dtOptions:{searching:!0,pageLength:25},columnsData:[{name:"title",orderable:!0},{name:null,template:"#rolePermissionActionColumnTemplate"}],scope:t}),s.reloadDT=function(){o.reloadDT(s.rolePermissionDataTable)},s.delete=function(t,e){var a=$("#lwRolePermissionDeleteTextMsg");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.user.role_permission.write.delete",rolePermissionIdOrUid:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),s.reloadDT()})})})},s.showAddNewDialog=function(){n.showDialog({},{templateUrl:__globals.getTemplateURL("user.role-permission.add-dialog"),controller:"AddRoleController as addRoleCtrl",resolve:{addSupportData:function(){return r.getAddSupportData()}}},function(t){_.has(t.value,"role_Added")&&!0===t.value.role_Added&&s.reloadDT()})},s.rolePermissionDialog=function(t,e){n.showDialog({roleId:t,title:_.unescape(e)},{templateUrl:__globals.getTemplateURL("user.role-permission.dynamic-role-permissions"),controller:"DynamicRolePermissionController as DynamicRolePermissionCtrl",resolve:{permissionData:function(){return r.getPermissions(t)}}},function(t){})}}]).controller("DynamicRolePermissionController",["$scope","__DataStore","__Form","$stateParams","appServices","permissionData",function(e,t,a,o,n,i){var r=this,s=e.ngDialogData,l=s.roleId;(r=a.setup(r,"user_role_dynamic_access","accessData",{secured:!0,unsecuredFields:[]})).title=s.title,r.permissions=i.permissions,r.accessData.allow_permissions=i.allow_permissions,r.accessData.deny_permissions=i.deny_permissions,r.checkedPermission={},r.disablePermissions=function(t,a){_.map(t.children,function(e){_.includes(e.dependencies,a)&&_.delay(function(t){$('input[name="'+e.id+'"]').attr("disabled",!0)},500)})},_.map(r.accessData.allow_permissions,function(t){r.checkedPermission[t]="2"}),_.map(r.accessData.deny_permissions,function(a){r.checkedPermission[a]="3",_.map(r.permissions,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&r.disablePermissions(t,a),_.has(t,"children_permission_group")&&_.map(t.children_permission_group,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&r.disablePermissions(t,a)})})}),(r=a.updateModel(r,r.accessData)).checkPermission=function(a,o){_.isString(o)||(o=o.toString()),"2"==(r.checkedPermission[a]=o)?(_.includes(r.accessData.allow_permissions,a)||r.accessData.allow_permissions.push(a),_.includes(r.accessData.deny_permissions,a)&&(r.accessData.deny_permissions=_.without(r.accessData.deny_permissions,a))):("3"==o?_.includes(r.accessData.deny_permissions,a)||r.accessData.deny_permissions.push(a):_.includes(r.accessData.deny_permissions,a)&&(r.accessData.deny_permissions=_.without(r.accessData.deny_permissions,a)),_.includes(r.accessData.allow_permissions,a)&&(r.accessData.allow_permissions=_.without(r.accessData.allow_permissions,a))),_.map(r.permissions,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&t.children[0].id!=a||_.includes(e,a)&&t.children[0].id==a&&_.map(t.children,function(e){e.id!=t.children[0].id&&_.map(e.dependencies,function(t){_.includes(e.dependencies,a)&&"3"==o?$('input[name="'+e.id+'"]').attr("disabled",!0):$('input[name="'+e.id+'"]').attr("disabled",!1)})}),_.has(t,"children_permission_group")&&_.map(t.children_permission_group,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&t.children[0].id!=a||_.includes(e,a)&&t.children[0].id==a&&_.map(t.children,function(e){e.id!=t.children[0].id&&_.map(e.dependencies,function(t){_.includes(e.dependencies,a)&&"3"==o?$('input[name="'+e.id+'"]').attr("disabled",!0):$('input[name="'+e.id+'"]').attr("disabled",!1)})})})})},r.submit=function(){a.process({apiURL:"manage.user.role_permission.write.create",roleId:l},r).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog()})})},r.valueUpdated=function(e,t,a,o){_.forEach(r.accessData.permissions,function(t){t[0].name==e&&(2==t[0].allow?_.map(t,function(t){_.isEmpty(t.dependencies)||(t.disabled=!1)}):3==t[0].allow?_.map(t,function(t){_.isEmpty(t.dependencies)||(t.disabled=!0,t.allow=3)}):1==t[0].allow&&(t[0].currentStatus?_.map(t,function(t){_.isEmpty(t.dependencies)||(t.disabled=!1,t.allow=1)}):_.map(t,function(t){_.isEmpty(t.dependencies)||(t.disabled=!0,t.allow=1)})))})},r.closeDialog=function(){e.closeThisDialog()}}]).controller("AddRoleController",["$scope","__DataStore","__Form","$stateParams","addSupportData","appServices","RolePermissionDataService",function(e,t,a,o,n,i,r){var s=this;(s=a.setup(s,"add_role","roleData",{secured:!0,unsecuredFields:[]})).userRoles=n.userRoles,s.permissions=n.permissionData,s.roleData.allow_permissions=[],s.roleData.deny_permissions=[],s.checkedPermission={},s.getPermissions=function(t){r.getAllPermissionsById(t).then(function(t){s.permissions=t.permissionData,s.roleData.selected_permissions=t.allowedData,s.roleData.allow_permissions=t.allow_permissions,s.roleData.deny_permissions=t.deny_permissions,s.checkedPermission={},_.map(s.roleData.allow_permissions,function(t){s.checkedPermission[t]="2"}),_.map(s.roleData.deny_permissions,function(t){s.checkedPermission[t]="3"})})},s.checkPermission=function(a,o){_.isString(o)||(o=o.toString()),"2"==(s.checkedPermission[a]=o)?(_.includes(s.roleData.allow_permissions,a)||s.roleData.allow_permissions.push(a),_.includes(s.roleData.deny_permissions,a)&&(s.roleData.deny_permissions=_.without(s.roleData.deny_permissions,a))):"3"==o&&(_.includes(s.roleData.deny_permissions,a)||s.roleData.deny_permissions.push(a),_.includes(s.roleData.allow_permissions,a)&&(s.roleData.allow_permissions=_.without(s.roleData.allow_permissions,a))),_.map(s.permissions,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&t.children[0].id!=a||_.includes(e,a)&&t.children[0].id==a&&_.map(t.children,function(e){e.id!=t.children[0].id&&_.map(e.dependencies,function(t){_.includes(e.dependencies,a)&&"3"==o?$('input[name="'+e.id+'"]').attr("disabled",!0):$('input[name="'+e.id+'"]').attr("disabled",!1)})}),_.has(t,"children_permission_group")&&_.map(t.children_permission_group,function(t){var e=_.pluck(t.children,"id");_.includes(e,a)&&t.children[0].id!=a||_.includes(e,a)&&t.children[0].id==a&&_.map(t.children,function(e){e.id!=t.children[0].id&&_.map(e.dependencies,function(t){_.includes(e.dependencies,a)&&"3"==o?$('input[name="'+e.id+'"]').attr("disabled",!0):$('input[name="'+e.id+'"]').attr("disabled",!1)})})})})},s.submit=function(){a.process("manage.user.role_permission.write.role.create",s).success(function(t){i.processResponse(t,null,function(){e.closeThisDialog({role_Added:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.ActivityDataServices",[]).service("ActivityDataServices",["$q","__DataStore","appServices",function(t,e,a){}])}(window),function(I){"use strict";I.module("app.ActivityEngine",[]).controller("ActivityLogListController",["$scope","__DataStore","__Form","$stateParams","appServices","ActivityDataServices",function(t,e,a,o,n,i){var r=[{name:"created_at",orderable:!0},{name:"created_by_user",orderable:!0},{name:"entity_type",orderable:!0},{name:"ip",orderable:!1},{name:"activity"},{name:"description"}],s=this;(s=a.setup(s,"activity_form_filters","activityLogsData",{secured:!1,unsecuredFields:[]})).getDate=function(t,e,a){s.startDate=e,s.endDate=a,s.duration=t},s.changeDate=function(t,e){s.startDate>s.endDate&&(s.endDate=s.startDate)};var l,c,u=moment().startOf("month").format("YYYY-MM-D"),d=moment().endOf("month").format("YYYY-MM-D"),p=moment().subtract(1,"months").startOf("month").format("YYYY-MM-D"),m=moment().subtract(1,"months").endOf("month").format("YYYY-MM-D"),g=moment().startOf("week").format("YYYY-MM-D"),f=moment().endOf("week").format("YYYY-MM-D"),D=moment().subtract(1,"week").startOf("week").format("YYYY-MM-D"),b=moment().subtract(1,"week").endOf("week").format("YYYY-MM-D"),h=moment().startOf("day").format("YYYY-MM-D"),y=moment().endOf("day").format("YYYY-MM-D"),v=moment().subtract(1,"day").format("YYYY-MM-D"),C=moment().subtract(1,"day").format("YYYY-MM-D"),S=moment().subtract(1,"years").startOf("years").format("YYYY-MM-D"),w=moment().subtract(1,"years").endOf("years").format("YYYY-MM-D"),T=moment().startOf("years").format("YYYY-MM-D"),x=moment().endOf("years").format("YYYY-MM-D"),U=moment().subtract(30,"days").format("YYYY-MM-D"),L=moment().format("YYYY-MM-D");s.activityDataTable=function(t,e,a){switch(parseInt(t)){case 1:l=u,c=d,s.getDate(t,l,c);break;case 2:l=p,c=m,s.getDate(t,l,c);break;case 3:l=g,c=f,s.getDate(t,l,c);break;case 4:l=D,c=b,s.getDate(t,l,c);break;case 5:l=h,c=y,s.getDate(t,l,c);break;case 6:l=v,c=C,s.getDate(t,l,c);break;case 7:l=S,c=w,s.getDate(t,l,c);break;case 8:l=T,c=x,s.getDate(t,l,c);break;case 9:l=U,c=L,s.getDate(t,l,c);break;case 10:}},s.dateChange=function(){s.activityLogDataTable&&s.activityLogDataTable.destroy(),s.activityLogDataTable=e.dataTable("#lwActivityLogList",{url:{apiURL:"manage.activity_log.read.list",startDate:s.startDate,endDate:s.endDate},dtOptions:{searching:!0,order:[[0,"desc"]],pageLength:25},columnsData:r,scope:t},null,function(t){s.durations=t._options.durations})},s.reloadDT=function(){e.reloadDT(s.activityLogDataTable)},t.$on("activity_added_or_updated",function(t){t&&s.dateChange("Today",moment().format("YYYY-MM-D"),moment().format("YYYY-MM-D"))}),t.$watch("activityLogListCtrl.startDate",function(t,e){var a=I.element("#endDate");_.isEmpty(t)?a.bootstrapMaterialDatePicker("setMinDate",""):a.bootstrapMaterialDatePicker("setMinDate",t)}),s.activityDataTable("1",moment().format("YYYY-MM-D"),moment().format("YYYY-MM-D")),s.dateChange()}])}((window,window.angular)),function(){"use strict";window.angular.module("app.CategoryDataServices",[]).service("CategoryDataService",["$q","__DataStore","appServices",function(e,o,n){this.getEditSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.category.read.update_data",categoryId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.CategoryEngine",[]).controller("CategoryListController",["$scope","__DataStore","__Form","$stateParams","appServices","CategoryDataService",function(t,o,e,a,n,i){var r=this;r.categoryDataTable=o.dataTable("#lwCategoryList",{url:"manage.category.read.list",dtOptions:{searching:!0,order:[[2,"desc"]]},columnsData:[{name:"name",orderable:!0},{name:"status",orderable:!0},{name:"created_at",orderable:!0},{name:null,template:"#categoryActionColumnTemplate"}],scope:t}),r.reloadDT=function(){o.reloadDT(r.categoryDataTable)},(r=e.setup(r,"category_add_form","categoryData")).submit=function(){e.process("manage.category.write.create",r).success(function(t){n.processResponse(t,null,function(t){1==t&&(r.categoryData.name="",r.reloadDT())})})},r.openEditDialog=function(t){n.showDialog({},{templateUrl:"category.edit-dialog",controller:"CategoryEditController as CategoryEditCtrl",resolve:{CategoryUpdateData:function(){return i.getEditSupportData(t)}}},function(t){_.has(t.value,"category_updated")&&t.value.category_updated&&r.reloadDT()})},r.delete=function(t,e){var a=$("#categoryDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.category.write.delete",categoryId:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),r.reloadDT()})})})}}]).controller("CategoryEditController",["$scope","appServices","__Form","CategoryUpdateData",function(e,a,t,o){var n=this,n=t.setup(n,"category_edit_form","categoryData"),o=o.updateData,i=o.id;(n=t.updateModel(n,o)).submit=function(){t.process({apiURL:"manage.category.write.update",categoryId:i},n).success(function(t){a.processResponse(t,null,function(){e.closeThisDialog({category_updated:!0})})})},n.closeDialog=function(){e.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.CustomerDataServices",[]).service("CustomerDataService",["$q","__DataStore","appServices",function(e,o,n){this.getAddSupportData=function(){var a=e.defer();return o.fetch("manage.customer.read.support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getEditSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.customer.read.update.data",customerIdOrUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.CustomerEngine",[]).controller("CustomerController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("CustomerListController",["$scope","__DataStore","__Form","$state","appServices","CustomerDataService",function(t,o,e,a,n,i){var r=this;r.customerDataTable=o.dataTable("#lwcustomerList",{url:"manage.customer.read.list",dtOptions:{searching:!0},columnsData:[{name:"name",orderable:!0},{name:"short_description"},{name:null,template:"#customerActionColumnTemplate"}],scope:t}),r.reloadDT=function(){o.reloadDT(r.customerDataTable)},r.delete=function(t,e){var a=$("#customerDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.customer.write.delete",customerIdOrUid:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),r.reloadDT()})})})},r.openAddDialog=function(){n.showDialog(r,{templateUrl:__globals.getTemplateURL("customer.add-dialog"),controller:"CustomerAddController as customerAddCtrl",resolve:{customerAddData:function(){return i.getAddSupportData()}}},function(t){_.has(t.value,"customer_added_or_updated")&&t.value.customer_added_or_updated&&r.reloadDT()})},r.openEditDialog=function(t){n.showDialog({customerIdOrUid:t},{templateUrl:__globals.getTemplateURL("customer.edit-dialog"),controller:"CustomerEditController as customerEditCtrl",resolve:{customerEditData:function(){return i.getEditSupportData(t)}}},function(t){_.has(t.value,"customer_added_or_updated")&&t.value.customer_added_or_updated&&r.reloadDT()})}}]).controller("CustomerAddController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","customerAddData",function(e,t,a,o,n,i,r){var s=this;s.showLoader=!0,(s=a.setup(s,"customer_form","customerData")).countries=r.countries,s.countrySelectConfig=__globals.getSelectizeOptions(),s.submit=function(){a.process("manage.customer.write.create",s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({customer_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}]).controller("CustomerEditController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","customerEditData",function(e,t,a,o,n,i,r){var s=this,l=(s.showLoader=!0,s=a.setup(s,"customer_form","customerData"),r.customer),c=((s=a.updateModel(s,l)).showLoader=!1,e.ngDialogData.customerIdOrUid);s.countries=r.countries,s.countrySelectConfig=__globals.getSelectizeOptions(),s.submit=function(){a.process({apiURL:"manage.customer.write.update",customerIdOrUid:c},s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({customer_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.SuppliersDataServices",[]).service("SuppliersDataService",["$q","__DataStore","appServices",function(e,o,n){this.getEditSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.suppliers.read.update.data",suppliersIdOrUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.SuppliersEngine",[]).controller("SuppliersController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("SuppliersListController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","SuppliersDataService",function(t,o,e,a,n,i,r){var s=this;s.suppliersDataTable=o.dataTable("#lwsuppliersList",{url:"manage.suppliers.read.list",dtOptions:{searching:!0},columnsData:[{name:"name",orderable:!0},{name:"short_description"},{name:null,template:"#suppliersActionColumnTemplate"}],scope:t}),s.reloadDT=function(){o.reloadDT(s.suppliersDataTable)},s.delete=function(t,e){var a=$("#suppliersDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.suppliers.write.delete",suppliersIdOrUid:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),s.reloadDT()})})})},s.openAddDialog=function(){n.showDialog(s,{templateUrl:__globals.getTemplateURL("suppliers.add-dialog"),controller:"SuppliersAddController as suppliersAddCtrl"},function(t){_.has(t.value,"suppliers_added_or_updated")&&t.value.suppliers_added_or_updated&&s.reloadDT()})},s.openEditDialog=function(t){n.showDialog({suppliersIdOrUid:t},{templateUrl:__globals.getTemplateURL("suppliers.edit-dialog"),controller:"SuppliersEditController as suppliersEditCtrl",resolve:{suppliersEditData:function(){return r.getEditSupportData(t)}}},function(t){_.has(t.value,"suppliers_added_or_updated")&&t.value.suppliers_added_or_updated&&s.reloadDT()})}}]).controller("SuppliersAddController",["$scope","__DataStore","__Form","$state","appServices","$rootScope",function(a,t,e,o,n,i){var r=this;r.showLoader=!0,(r=e.setup(r,"suppliers_form","suppliersData")).submit=function(){e.process("manage.suppliers.write.create",r).success(function(t){var e=t.data;n.processResponse(t,null,function(){a.closeThisDialog({suppliers_added_or_updated:!0,requestData:e})})})},r.closeDialog=function(){a.closeThisDialog()}}]).controller("SuppliersEditController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","suppliersEditData",function(e,t,a,o,n,i,r){var s=this,l=(s.showLoader=!0,s=a.setup(s,"suppliers_form","suppliersData"),(s=a.updateModel(s,r)).showLoader=!1,e.ngDialogData.suppliersIdOrUid);s.submit=function(){a.process({apiURL:"manage.suppliers.write.update",suppliersIdOrUid:l},s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({suppliers_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.ProductDataServices",[]).service("ProductDataService",["$q","__DataStore","appServices",function(e,o,n){this.getAddSupportData=function(){var a=e.defer();return o.fetch("manage.product.read.support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getEditSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.product.read.update.data",productIdOrUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getDetails=function(t){var a=e.defer();return o.fetch({apiURL:"manage.product.read.get_details",productIdOrUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.ProductEngine",[]).controller("ProductController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("ProductListController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","ProductDataService",function(t,o,e,a,n,i,r){var s=this;s.productDataTable=o.dataTable("#lwproductList",{url:"manage.product.read.list",dtOptions:{searching:!0},columnsData:[{name:"name",orderable:!0,template:"#productNameColumnTemplate"},{name:"short_description"},{name:"category"},{name:"status",orderable:!0},{name:null,template:"#productActionColumnTemplate"}],scope:t}),s.reloadDT=function(){o.reloadDT(s.productDataTable)},t.$on("product_added_or_updated",function(t){t&&s.reloadDT()}),s.openDetailsDialog=function(e){n.showDialog(s,{templateUrl:__globals.getTemplateURL("product.details-dialog"),controller:"ProductDetailsCotroller as ProductDetailsCtrl",resolve:{GetDetails:["ProductDataService",function(t){return t.getDetails(e)}]}},function(t){})},s.delete=function(t,e){var a=$("#productDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.product.write.delete",productIdOrUid:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),s.reloadDT()})})})}}]).controller("ProductAddController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","productAddData",function(t,e,a,o,n,i,r){var s=this,l=((s=a.setup(s,"product_form","productData")).categorySelectConfig=__globals.getSelectizeOptions(),s.supplierSelectConfig=__globals.getSelectizeOptions(),s.labelSelectConfig=__globals.getSelectizeOptions({valueField:"id",labelField:"name",searchField:["name"],plugins:["restore_on_backspace"],create:function(t){return{id:t,name:t}}}),s.barcodesData=[],s.barcodesSelectConfig=__globals.getSelectizeOptions({valueField:"key",labelField:"value",searchField:["value"],maxItems:100,plugins:["remove_button"],delimiter:",",persist:!1,create:function(t){return s.checkUniqueBarCode(t)?(this.blur(),this.focus(),{key:null,value:null}):{key:t,value:t}}}),s.presetSelectize=__globals.getSelectizeOptions(),s.categories=r.categories,s.suppliers=r.suppliers,s.currency=r.currency,s.currencySymbol=r.currency_symbol,s.taxPresets=r.taxPresets,s.labelData=r.labelData,s.productData.optionLabels=[],!(s.productData.optionLabels=[{title:"",product_id:"",price:null,barcodes:[],values:[{label_name:"",value_name:""}]}]));s.checkUniqueBarCode=function(e){return l=!1,_.map(s.productData.optionLabels,function(t){_.includes(t.barcodes,e)&&(l=!0)}),l},s.addMoreCombination=function(t){s.labelData.push({id:t,name:t}),s.productData.optionLabels.push({title:"",product_id:"",price:null,barcodes:[],values:[{label_name:"",value_name:""}]})},s.removeCombination=function(a){_.remove(s.productData.optionLabels,function(t,e){return e==a})},s.addMoreValue=function(t){s.productData.optionLabels[t].values.push({label_name:"",value_name:""})},s.removeValue=function(t,a){_.remove(s.productData.optionLabels[t].values,function(t,e){return e==a})},s.submit=function(){a.process("manage.product.write.create",s).success(function(t){n.processResponse(t,null,function(t){1==t&&o.go("product")})})},s.addNewCategory=function(t){_.isUndefined(t)||e.post("manage.category.write.create_from_product",{name:t}).success(function(e){n.processResponse(e,null,function(t){1==t&&(s.category_name="",s.categories.push(e.data.addedCategory))})})}}]).controller("ProductEditController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","productEditData",function(t,r,e,a,s,o,n){var i=this,l=a.params.productIdOrUid,c=(i.showLoader=!0,i=e.setup(i,"product_form","productData"),n),u=(i.barcodesOp=c.barcodesOp,i.categorySelectConfig=__globals.getSelectizeOptions(),i.supplierSelectConfig=__globals.getSelectizeOptions(),i.labelSelectConfig=__globals.getSelectizeOptions({valueField:"id",labelField:"name",searchField:["name"],plugins:["restore_on_backspace"],create:function(t){return{id:t,name:t}}}),i.barcodesSelectConfig=__globals.getSelectizeOptions({valueField:"key",labelField:"value",searchField:["value"],maxItems:100,plugins:["remove_button"],delimiter:",",persist:!1,create:function(t){return i.checkUniqueBarCode(t)?(this.blur(),this.focus(),{key:null,value:null}):{key:t,value:t}},onDelete:function(t){i.checkBarcodeDelete(t,this).then(function(t){return!0}).catch(function(t){return!1});return!1}}),i.checkBarcodeDelete=function(n,i){return new Promise(function(e,a){var t=$("#barcodeDeleteConfirmation"),o=_.get(n,0);_.includes(c.barcodesArray,o)?__globals.showConfirmation({html:__globals.getReplacedString(t,"__name__",o),confirmButtonText:t.attr("data-delete-button-text")},function(){r.post("manage.barcode.write.delete",{barcode:o}).success(function(t){s.processResponse(t,null,function(t){i.removeOption(o),i.refreshOptions(),i.clearCache(),e("success")})}).error(function(t){a("error")})}):(i.removeOption(o),i.refreshOptions(),i.clearCache())})},i.presetSelectize=__globals.getSelectizeOptions(),i.currency=c.currency,i.currencySymbol=c.currency_symbol,i.categories=c.categories,i.suppliers=c.suppliers,i.labelData=c.labelData,i.taxPresets=c.taxPresets,i=e.updateModel(i,c.updateData),_.isEmpty(i.productData.optionLabels)&&(i.productData.optionLabels=[{title:"",product_id:"",price:null,barcodes:[],values:[{label_name:"",value_name:""}]}]),!1);i.checkUniqueBarCode=function(e){return u=!1,_.map(i.productData.optionLabels,function(t){_.includes(t.barcodes,e)&&(u=!0)}),u},i.addMoreCombination=function(t){i.labelData.push({id:t,name:t}),i.productData.optionLabels.push({title:"",product_id:"",price:null,barcodes:[],values:[{label_name:"",value_name:""}]})},i.removeCombination=function(a){_.remove(i.productData.optionLabels,function(t,e){return e==a})},i.addMoreValue=function(t){i.productData.optionLabels[t].values.push({label_name:"",value_name:""})},i.removeValue=function(t,a){_.remove(i.productData.optionLabels[t].values,function(t,e){return e==a})},i.deleteValue=function(t,e,a,o){r.post({apiURL:"manage.product.value.write.delete",productId:l,comboId:o,valueId:t}).success(function(t){s.processResponse(t,null,function(t){i.removeValue(e,a)})})},i.deleteCombination=function(t,e){r.post({apiURL:"manage.product.combination.write.delete",productId:l,combinationId:t}).success(function(t){s.processResponse(t,null,function(t){i.removeCombination(e)})})},i.submit=function(){e.process({apiURL:"manage.product.write.update",productIdOrUid:l},i).success(function(t){s.processResponse(t,null,function(t){1==t&&a.go("product")})})}}]).controller("ProductDetailsCotroller",["$scope","GetDetails",function(t,e){this.details=e.details,this.closeDialog=function(){t.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.LocationDataServices",[]).service("LocationDataService",["$q","__DataStore","appServices",function(e,o,n){this.getAddSupportData=function(){var a=e.defer();return o.fetch("manage.location.read.support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getEditSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.location.read.update.data",locationIdOrUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getAssignLocationData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.location.read.assign_location",userAuthorityId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getAssignUserData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.location.read.assign_user",locationId:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.LocationEngine",[]).controller("LocationController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("LocationListController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","LocationDataService",function(t,o,e,a,n,i,r){var s=this;s.locationDataTable=o.dataTable("#lwlocationList",{url:"manage.location.read.list",dtOptions:{searching:!0},columnsData:[{name:"name",orderable:!0},{name:"location_id",orderable:!0},{name:"status",orderable:!0},{name:"short_description"},{name:null,template:"#locationActionColumnTemplate"}],scope:t}),s.reloadDT=function(){o.reloadDT(s.locationDataTable)},s.delete=function(t,e){var a=$("#locationDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.location.write.delete",locationIdOrUid:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),s.reloadDT()})})})},s.openAddDialog=function(){n.showDialog(s,{templateUrl:__globals.getTemplateURL("location.add-dialog"),controller:"LocationAddController as locationAddCtrl",resolve:{locationAddData:function(){return r.getAddSupportData()}}},function(t){_.has(t.value,"location_added_or_updated")&&t.value.location_added_or_updated&&s.reloadDT()})},s.openEditDialog=function(t){n.showDialog({locationIdOrUid:t},{templateUrl:__globals.getTemplateURL("location.edit-dialog"),controller:"LocationEditController as locationEditCtrl",resolve:{locationEditData:function(){return r.getEditSupportData(t)}}},function(t){_.has(t.value,"location_added_or_updated")&&t.value.location_added_or_updated&&s.reloadDT()})},s.assignUser=function(t,e){n.showDialog({name:_.unescape(e),locationId:t},{templateUrl:__globals.getTemplateURL("location.assign-user-dialog"),controller:"AssignUserDialogController as AssignUserDialogCtrl",resolve:{assignUserData:function(){return r.getAssignUserData(t)}}},function(t){_.has(t.value,"location_added_or_updated")&&t.value.location_added_or_updated&&s.reloadDT()})}}]).controller("LocationAddController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","locationAddData",function(e,t,a,o,n,i,r){var s=this;s.showLoader=!0,(s=a.setup(s,"location_form","locationData")).parentLocations=r.parentLocationData,s.locationSelectConfig=__globals.getSelectizeOptions(),s.submit=function(){a.process("manage.location.write.create",s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({location_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}]).controller("LocationEditController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","locationEditData",function(e,t,a,o,n,i,r){var s=this,l=(s.showLoader=!0,(s=a.setup(s,"location_form","locationData")).locationSelectConfig=__globals.getSelectizeOptions(),(s=a.updateModel(s,r.locationData)).parentLocations=r.parentLocationData,s.showLoader=!1,e.ngDialogData.locationIdOrUid);s.submit=function(){a.process({apiURL:"manage.location.write.update",locationIdOrUid:l},s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({location_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}]).controller("AssignLocationController",["$scope","__DataStore","__Form","$stateParams","assignLocationData","appServices",function(e,t,a,o,n,i){var r=this,s=e.ngDialogData;r.userName=s.name,r.userAuthorityId=s.userAuthorityId,(r=a.setup(r,"assign_location_form","assignData")).locationData=n.locationData,(r=_.isEmpty(n.locationIds)?r:a.updateModel(r,n.locationIds)).locationSelectConfig=__globals.getSelectizeOptions({valueField:"id",labelField:"name",searchField:["name"],plugins:["remove_button"],maxItems:1e3,delimiter:","}),r.submit=function(){a.process({apiURL:"manage.location.write.location_assign_process",userAuthorityId:r.userAuthorityId},r).success(function(t){i.processResponse(t,null,function(){e.closeThisDialog()})})},r.closeDialog=function(){e.closeThisDialog()}}]).controller("AssignUserDialogController",["$scope","__DataStore","__Form","$stateParams","assignUserData","appServices",function(e,t,a,o,n,i){var r=this,s=e.ngDialogData;r.userData=n.userData,r.locationId=s.locationId,r.locationName=s.name,r=a.setup(r,"assign_user_form","assignData"),(r=_.isEmpty(n.userAuthorityIds)?r:a.updateModel(r,n.userAuthorityIds)).userSelectConfig=__globals.getSelectizeOptions({valueField:"id",labelField:"name",searchField:["name"],plugins:["remove_button"],maxItems:1e3,delimiter:","}),r.submit=function(){a.process({apiURL:"manage.location.write.user_assign_process",locationId:r.locationId},r).success(function(t){i.processResponse(t,null,function(){e.closeThisDialog()})})},r.closeDialog=function(){e.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.InventoryDataServices",[]).service("InventoryDataService",["$q","__DataStore","appServices",function(i,r,s){this.getInvetoryList=function(t){var a=i.defer();return r.fetch(t,{fresh:!0}).success(function(e){s.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getInventoryUpdateData=function(t,e,a,o){var n=i.defer();return r.fetch({apiURL:"manage.inventory.read.update_data",productId:t,combinationId:e,locationId:_.isUndefined(a)?null:a,supplierId:_.isUndefined(o)?null:o}).success(function(e){s.processResponse(e,null,function(t){n.resolve(e.data)})}),n.promise},this.getCombinationsLocationwise=function(t,e){var a=i.defer();return r.fetch({apiURL:"manage.billing.read.combinations_locationwise",combinationId:t,productId:e}).success(function(e){s.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getProductCombinationData=function(t){var a=i.defer();return r.fetch({apiURL:"manage.inventory.read.product_combination",productId:t}).success(function(e){s.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getInventoryTrasactionData=function(t,e,a,o){var n=i.defer();return r.fetch({apiURL:"manage.inventory.read.transaction_data",productId:t,combinationId:e,tranType:a,locationId:o}).success(function(e){s.processResponse(e,null,function(t){n.resolve(e.data)})}),n.promise}}])}(window),function(){"use strict";window.angular.module("app.InventoryEngine",[]).controller("InventoryListController",["$scope","__DataStore","__Form","$stateParams","appServices","InventoryDataService","__Utils",function(t,e,a,o,r,s,n){var l=this;l.sortBy="desc",l.pageContentLoaded=!1,l.search_term="",l.supplierSelectConfig=__globals.getSelectizeOptions(),l.categorySelectConfig=__globals.getSelectizeOptions(),l.inventorySelectConfig=__globals.getSelectizeOptions(),l.getInventories=function(t){var e,a,o;_.isEmpty(t)&&(e=_.isUndefined(l.supplier)?null:l.supplier,a=_.isUndefined(l.category)?null:l.category,o=_.isUndefined(l.inventory)?null:l.inventory,t=(t=n.apiURL("manage.inventory.read.list"))+"?supplier_id="+e+"&category_id="+a+"&inventory_id="+o+"&search_term="+l.search_term),s.getInvetoryList(t).then(function(t){l.invetoryData=t.invetoryData,l.paginationLinks=t.paginationLinks,l.sortOrder=t.sortOrder,l.sortOrderUrl=t.sortOrderUrl,l.suppliers=t.suppliers,l.categories=t.categories,l.inventories=t.inventories,l.paginationLinks&&$(".lw-pagination-container").html(l.paginationLinks),l.pageContentLoaded=!0})},l.getInventories(null),l.clearFilter=function(){l.supplier="",l.category="",l.inventory="",l.search_term="",l.getInventories(null)},l.sortBy=function(t,e){t=l.sortOrderUrl+(_.includes(l.sortOrderUrl,"?")?"&":"?")+"sort_by="+t+"&sort_order="+e;l.getInventories(t)},l.searchInvetory=function(t){t=l.sortOrderUrl+(_.includes(l.sortOrderUrl,"?")?"&":"?")+"search_term="+t;l.getInventories(t)},$(".lw-pagination-container").on("click","a",function(t){t.preventDefault();t=$(this).attr("href");l.getInventories(t)}),l.isArray=function(t){return _.isObject(t)},l.updateInventory=function(t,e,a,o,n,i){r.showDialog({productName:e,productId:t,type:n,combinationId:a,supplierId:i,showProductList:!!_.isEmpty(t)},{templateUrl:"inventory.update-inventory-dialog",controller:"UpdateInventoryController as UpdateInventoryCtrl",resolve:{InventoryUpdateData:function(){return s.getInventoryUpdateData(t,a,o,i)}}},function(t){_.has(t.value,"inventory_updated")&&t.value.inventory_updated&&l.getInventories(null)})},l.getInventoryTransaction=function(t,e,a,o,n){r.showDialog({productName:e,tranType:o},{templateUrl:"inventory.transaction-dialog",controller:"InventoryTransactionController as InventoryTransactionCtrl",resolve:{InventoryTransactionData:function(){return s.getInventoryTrasactionData(t,a,o,n)}}},function(t){})}}]).controller("UpdateInventoryController",["$scope","__DataStore","__Form","$stateParams","appServices","InventoryUpdateData","InventoryDataService",function(a,t,o,e,n,i,r){var s=this;(s=o.setup(s,"inventry_form","inventoryData")).combinationSelectConfig=__globals.getSelectizeOptions(),s.locationSelectConfig=__globals.getSelectizeOptions(),s.supplierSelectConfig=__globals.getSelectizeOptions(),s.ngDialogData=a.ngDialogData,s.product_name=s.ngDialogData.productName,s.productId=s.ngDialogData.productId,s.inventoryData.sub_type=s.ngDialogData.type,s.showProductList=s.ngDialogData.showProductList,s.inventoryData.combination=s.ngDialogData.combinationId,s.inventoryData.supplier=s.ngDialogData.supplierId,s.supplierRequired=!1,s.disableSupplier=!1,s.productData=i,s.availableQuantity=s.productData.availableQuantity,s.availableStockText="Current Stock",s.combinationExist=s.productData.combinationExist,s.isLocationExist=s.productData.locationExist,s.inventoryData.location=s.productData.locationId,s.products=s.productData.products,s.combinations=s.productData.combinations,s.subTypes=s.productData.subTypes,s.locations=s.productData.locations,s.suppliers=s.productData.suppliers,s.showInactiveMessage=s.productData.showInactiveMessage,s.currency=s.productData.currency,s.currencySymbol=s.productData.currencySymbol,s.calculationSign="",s.combinationOption="",_.isUndefined(s.inventoryData.combination)||_.forEach(s.combinations,function(t){t.id==s.inventoryData.combination&&(s.combinationOption=t.combinationOption)}),s.updateOption=function(){t.fetch({apiURL:"manage.inventory.write.calculate_options_quantity",productId:s.showProductList?_.isUndefined(s.inventoryData.product)?null:s.inventoryData.product:s.productId,combinationId:_.isUndefined(s.inventoryData.combination)?null:s.inventoryData.combination,locationId:_.isUndefined(s.inventoryData.location)?null:s.inventoryData.location,supplierId:_.isUndefined(s.inventoryData.supplier)?null:s.inventoryData.supplier,type:_.isUndefined(s.inventoryData.sub_type)?null:s.inventoryData.sub_type}).success(function(e){n.processResponse(e,null,function(){var t=e.data;s.formattedTotalAmount=t.formattedTotalAmount,s.availableQuantity=t.availableQuantity,_.isUndefined(s.inventoryData.combination)||_.forEach(s.combinations,function(t){t.id==s.inventoryData.combination&&(s.combinationOption=t.combinationOption)})})})},s.changeCalculationSign=function(t){1==t?(s.calculationSign="+",s.disableSupplier=!1,s.availableStockText="Current Stock",s.supplierRequired=!0):2==t?(s.calculationSign="-",s.inventoryData.supplier=null,s.disableSupplier=!0,s.availableStockText="Current Stock",s.supplierRequired=!1):3==t?(s.disableSupplier=!1,s.availableStockText="Returnable Stock",s.calculationSign="-",s.supplierRequired=!0):(5==t?(s.calculationSign="+",s.availableStockText="Current Stock",s.disableSupplier=!0,s.inventoryData.supplier=null):7==t?(s.calculationSign="-",s.inventoryData.supplier=null,s.disableSupplier=!0,s.availableStockText="Returnable Stock"):(s.calculationSign="-",s.inventoryData.supplier=null,s.disableSupplier=!0,s.availableStockText="Current Stock"),s.supplierRequired=!1),s.updateOption()},s.isTypeExist=!1,_.isEmpty(s.ngDialogData.type)||(s.isTypeExist=!0,s.changeCalculationSign(s.ngDialogData.type)),s.getProductCombinations=function(t){_.isUndefined(t)||r.getProductCombinationData(t).then(function(t){s.combinations=t.combinations})},s.submit=function(t){var e;s.inventry_form.$valid&&((e=$(t.currentTarget)).prop("disabled",!0),setTimeout(function(){e.prop("disabled",!1)},1e3)),o.process({apiURL:"manage.inventory.write.update",productId:s.showProductList?_.isUndefined(s.inventoryData.product)?null:s.inventoryData.product:s.productId},s).success(function(t){n.processResponse(t,null,function(){a.closeThisDialog({inventory_updated:!0,stockDetails:t.data.stockDetails})})})},s.closeDialog=function(){a.closeThisDialog()}}]).controller("InventoryTransactionController",["$scope","__DataStore","__Form","$stateParams","InventoryTransactionData",function(t,e,a,o,n){var i=this;i.ngDialogData=t.ngDialogData,i.isSingleOptionSelected=!1,i.optionValues=i.ngDialogData.optionValues,i.productName=i.ngDialogData.productName,i.tranType=i.ngDialogData.tranType,i.transactionData=n.transactionData,i.combinations=n.combinations,i.closeDialog=function(){t.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.ReportDataServices",[]).service("ReportDataService",["$q","__DataStore","appServices",function(t,e,o){this.getSupportData=function(){var a=t.defer();return e.fetch("manage.report.read.support_data").success(function(e){o.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(r){"use strict";r.module("app.ReportEngine",[]).controller("ReportListController",["$scope","__DataStore","__Form","GetSupportData",function(a,o,t,e){var n=this,e=(n.durations=e.durations,n.stock_subtype=e.stock_trn_subtypes,n.locations=e.locations,n.locationsSelectConfig=__globals.getSelectizeOptions({valueField:"_id",labelField:"title",searchField:["title"],maxItems:100,plugins:["remove_button"]}),(n=t.setup(n,"manage_report_list","reportData")).reportData.stock_subtype="1",n.duration="8",n.monthFirstDay=moment().startOf("month").format("YYYY-MM-DD"),n.monthLastDay=moment().endOf("month").format("YYYY-MM-DD"),n.lastMonthFirstDay=moment().subtract(1,"months").startOf("month").format("YYYY-MM-DD"),n.lastMonthLastDay=moment().subtract(1,"months").endOf("month").format("YYYY-MM-DD"),n.currentWeekFirstDay=moment().startOf("week").format("YYYY-MM-DD"),n.currentWeekLastDay=moment().endOf("week").format("YYYY-MM-DD"),n.lastWeekFirstDay=moment().weekday(-7).format("YYYY-MM-DD"),n.lastWeekLastDay=moment().weekday(-1).format("YYYY-MM-DD"),n.today=moment().format("YYYY-MM-DD"),n.yesterday=moment().subtract(1,"day").format("YYYY-MM-DD"),n.lastYearFirstDay=moment().subtract(1,"year").startOf("year").format("YYYY-MM-DD"),n.lastYearLastDay=moment().subtract(1,"year").endOf("year").format("YYYY-MM-DD"),n.currentYearFirstDay=moment().startOf("year").format("YYYY-MM-DD"),n.currentYearLastDay=moment().endOf("year").format("YYYY-MM-DD"),n.last30Days=moment().subtract(30,"day").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD")),i=(n.reportData.start=e,n.reportData.end=e,n.startDateConfig={time:!1},n.endDateConfig={minDate:moment().format("YYYY-MM-DD"),time:!1},a.$watch("reportListCtrl.reportData.start",function(t,e){var a=r.element("#end");_.isEmpty(t)?a.bootstrapMaterialDatePicker("setMinDate",""):a.bootstrapMaterialDatePicker("setMinDate",t)}),n.startDateUpdated=function(t){n.reportData.start=t},n.endDateUpdated=function(t){n.reportData.start>n.reportData.end&&(n.reportData.end=t),n.reportData.end=t},n.durationChange=function(t){1==t?(n.reportData.start=n.monthFirstDay,n.reportData.end=n.monthLastDay):2==t?(n.reportData.start=n.lastMonthFirstDay,n.reportData.end=n.lastMonthLastDay):3==t?(n.reportData.start=n.currentWeekFirstDay,n.reportData.end=n.currentWeekLastDay):4==t?(n.reportData.start=n.lastWeekFirstDay,n.reportData.end=n.lastWeekLastDay):5==t?(n.reportData.start=n.today,n.reportData.end=n.today):6==t?(n.reportData.start=n.yesterday,n.reportData.end=n.yesterday):7==t?(n.reportData.start=n.lastYearFirstDay,n.reportData.end=n.lastYearLastDay):8==t?(n.reportData.start=n.currentYearFirstDay,n.reportData.end=n.currentYearLastDay):9==t&&(n.reportData.start=n.last30Days,n.reportData.end=n.today)},n.durationChange(n.duration),[{name:"product_id",orderable:!0},{name:"title",orderable:!0},{name:"location_name",orderable:!0},{name:"formated_created_at",orderable:!0},{name:"quantity",orderable:!0},{name:"formated_price",orderable:!0},{name:"formated_total"},{name:"formatted_tax",template:"#taxAmountTemplate"},{name:"formated_amount"}]);n.getReports=function(){n.reportDataTable&&n.reportDataTable.destroy();var t=$("#lwReportInput"),e=__ngSupport.getText(t.data("filename"),{__filename__:n.stock_subtype[n.reportData.stock_subtype]}),t=__ngSupport.getText(t.data("top-message"),{__start__:n.reportData.start,__end__:n.reportData.end});(_.isEmpty(n.reportData.locations)||_.isUndefined(n.reportData.locations))&&(n.reportData.locations=null),n.reportDataTable=o.dataTable("#lwreportList",{url:{apiURL:"manage.report.read.list",start:n.reportData.start,end:n.reportData.end,subtype:n.reportData.stock_subtype,locations:n.reportData.locations},dtOptions:{searching:!0,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],pageLength:25,columnDefs:[{class:"text-right",targets:[4,5,6,8]},{targets:[6,7],visible:2==n.reportData.stock_subtype}],dom:"Bfrtip",buttons:["pageLength","copy",{extend:"excel",footer:!0,exportOptions:{columns:2==n.reportData.stock_subtype?[0,1,2,3,4,5,6,7,8]:[0,1,2,3,4,5,8]},messageTop:t,title:e,customize:function(t){t=t.xl.worksheets["sheet1.xml"];$("row:last c",t).attr("s","52")}},{extend:"pdf",footer:!0,exportOptions:{columns:2==n.reportData.stock_subtype?[0,1,2,3,4,5,6,7,8]:[0,1,2,3,4,5,8]},messageTop:t,title:e,customize:function(t){$(t.styles.tableBodyEven).css("text-align","right;"),$(t.styles.tableBodyOdd).css("text-align","right;"),console.log(t.styles)}},{extend:"print",footer:!0,exportOptions:{columns:2==n.reportData.stock_subtype?[0,1,2,3,4,5,6,7,8]:[0,1,2,3,4,5,8]},messageTop:t,title:e,autoPrint:!0,customize:function(t){$(t.document.body).css("font-size","10pt").prepend('<img src="'+__globals.configItem("logo_image_url")+'" style="position:absolute; top:0; left:0;" /><br><br><br>'),$(t.document.body).find("table").addClass("compact").css("font-size","inherit"),$(t.document.body).find("table.dataTable > tbody > tr > td:first-child").addClass("lw-remove-plus-icon"),$(t.document.body).find("table.dataTable > tbody > tr > th:first-child").addClass("lw-remove-plus-icon")}}],footerCallback:function(t,e,a,o,n){var i=this.api(),r=[],s=[],l={},c={},u=(_.forEach(e,function(t,e){l[t.currency_code]||(l[t.currency_code]=[],c[t.currency_code]=t.currency_symbol),l[t.currency_code].push(t.total_amount),r.push(t.total_amount),s.push(t.total_price)})," Total: <br>");_.forEach(l,function(t,e){u+=" "+__globals.priceFormat(_.sum(t),c[e],e)+"<br>"}),$(i.column(8).footer()).html(u)}},columnsData:i,scope:a})},n.getReports(),n.reloadDT=function(){o.reloadDT(n.reportDataTable)},a.$on("report_added_or_updated",function(t){t&&n.reloadDT()})}])}((window,window.angular)),function(){"use strict";window.angular.module("app.BillingDataServices",[]).service("BillingDataService",["$q","__DataStore","appServices",function(e,o,n){this.getAddSupportData=function(){var a=e.defer();return o.fetch("manage.billing.read.add_support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getEditSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.billing.read.edit_support_data",billUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getDetailsSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.billing.read.details_support_data",billUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getProductCombinations=function(t){var a=e.defer();return o.fetch({apiURL:"manage.billing.read.search_combination_for_bill",searchTerm:t},{fresh:!0}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.BillingEngine",[]).controller("BillingController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("BillingListController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","BillingDataService",function(t,o,e,a,n,i,r){var s=this;s.billingDataTable=o.dataTable("#lwbillingList",{url:"manage.billing.read.list",dtOptions:{searching:!0,columnDefs:[{className:"text-right",targets:[3]}]},columnsData:[{name:"bill_number",orderable:!0,template:"#billingTitleColumnTemplate"},{name:"txn_id",orderable:!0},{name:"customer_name",orderable:!0},{name:"total_amount",orderable:!0},{name:"formatted_status",orderable:!0},{name:"bill_date",orderable:!0},{name:null,template:"#billingActionColumnTemplate"}],scope:t}),s.reloadDT=function(){o.reloadDT(s.billingDataTable)},t.$on("billing_added_or_updated",function(t){t&&s.reloadDT()}),s.delete=function(t,e){var a=$("#billDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__billno__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.billing.write.delete",billId:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),s.reloadDT()})})})}}]).controller("BillingAddController",["$scope","__DataStore","__Form","$stateParams","GetAddSupportData","BillingDataService","$compile","__Utils","appServices","InventoryDataService","$state",function(t,e,a,o,n,r,i,s,l,c,u){var d=this,p=(d.productData=[],d.currencyCode=n.currencyCode,d.currencySymbol=n.currencySymbol,(d=a.setup(d,"billing_form","billingData")).billingData.tax_amount=0,d.billingData.formatted_tax_amount=__globals.priceFormat(0,d.currencySymbol,""),d.billingData.discount_amount=0,d.billingData.formatted_discount_amount=__globals.priceFormat(0,d.currencySymbol,""),d.billingData.tax_type="1",d.billingData.discount_type="1",d.dateConfig={minDate:moment().format("YYYY-MM-DD"),time:!1},moment().format("YYYY-MM-DD"));d.billingData.bill_date=p,d.billingData.due_date=p,d.customerSelectConfig=__globals.getSelectizeOptions(),d.combinationSelectConfig=__globals.getSelectizeOptions({valueField:"id",labelField:"name",searchField:["name","comboSKU","barcode","combinationTitle","location_name"],options:[],create:!1,onChange:function(t){this.clearOptions()},onFocus:function(t){this.clearOptions()},loadThrottle:500,render:{option:function(t,e){return i(s.template("#lwSelectizeOp",{item:t}))(d)}},load:function(e,a,t){var o=this,n=$(this)[0].$input[0],i=$(n).data("key");if(!e.length)return a();r.getProductCombinations(e).then(function(t){d.productData=t.productData,_.forEach(d.productData,function(t){t.barcode==e&&(d.showProductDetails(t.id,i),o.blur(),o.clearOptions(),o.focus())}),_.isEmpty(d.productData)&&(o.blur(),o.clearOptions(),o.focus()),a(t.productData)})}}),d.userData=n.userData,d.customerData=n.customerData,d.billingData.customerDetails=null,d.subTotal=0,d.formattedSubTotal=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.billingData.totalAmount=0,d.formattedTotalAmount=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.formattedTaxTotalAmount=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.formattedUnitPriceTotal=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.billingData.is_add_tax=!1,d.billingData.is_add_discount=!1,d.billingData.productCombinations=[],d.removeItem=function(a){_.remove(d.billingData.productCombinations,function(t,e){return e==a})},d.addNewRow=function(){d.billingData.productCombinations.push({combination:[],taxes:[],unit_price:0,formattedUnitPrice:__globals.priceFormat(0,d.currencySymbol,""),quantity:0,price:0,formattedPrice:__globals.priceFormat(0,d.currencySymbol,""),showDetails:!1,location_id:null,location_name:"",tax_details:[],tax_presets__id:null});d.billingData.productCombinations.length},d.isEnterKeyPress=function(t,e){13===(t.which||t.keyCode)&&d.addNewRow()},d.combinationExists=function(a,o){var n=!1;return _.isEmpty(d.billingData.productCombinations)||_.forEach(d.billingData.productCombinations,function(t,e){t.combination.id==a&&o==t.location_id&&(n=!0,d.billingData.productCombinations[e].quantity++,d.calculateTotalPrice())}),n},d.choosedLocation=[],d.showProductDetails=function(e){var a=[];_.forEach(d.productData,function(t){t.id==e&&(a=t)}),_.isEmpty(a)||(_.isUndefined(a.isQuantityExist)||a.isQuantityExist?a.chooseInventryByLocation?d.chooseInventryByLocation(e,a):d.updateProductDetails(a):d.showAlertMessage(a))},d.updateProductDetails=function(t,e){var a,o=null;_.isUndefined(e)?(o=t.location_id,d.combinationExists(t.id,o)||(d.addNewRow(),a=d.billingData.productCombinations.length-1,d.billingData.productCombinations[a].showDetails=!1,d.billingData.productCombinations[a].combination=t,d.billingData.productCombinations[a].taxes=t.taxes,d.billingData.productCombinations[a].unit_price=t.salePrice,d.billingData.productCombinations[a].tax_presets__id=t.tax_presets__id,d.billingData.productCombinations[a].formattedUnitPrice=t.formattedSalePrice,d.billingData.productCombinations[a].showDetails=!0,d.billingData.productCombinations[a].quantity=1,d.billingData.productCombinations[a].location_name=t.location_name,d.billingData.productCombinations[a].location_id=t.location_id)):(o=e.location_id,d.combinationExists(t.id,o)||(d.addNewRow(),a=d.billingData.productCombinations.length-1,d.billingData.productCombinations[a].showDetails=!1,d.billingData.productCombinations[a].combination=t,d.billingData.productCombinations[a].taxes=t.taxes,d.billingData.productCombinations[a].unit_price=t.salePrice,d.billingData.productCombinations[a].tax_presets__id=t.tax_presets__id,d.billingData.productCombinations[a].formattedUnitPrice=t.formattedSalePrice,d.billingData.productCombinations[a].showDetails=!0,d.billingData.productCombinations[a].quantity=1,d.billingData.productCombinations[a].location_name=t.location_name,d.billingData.productCombinations[a].location_id=e.location_id,d.billingData.productCombinations[a].location_name=e.location,d.billingData.productCombinations[a].combination.quantity=parseInt(e.quantity),d.billingData.productCombinations[a].combination.lockQuantity=parseInt(e.lockQuantity),d.billingData.productCombinations[a].combination.availableQty=parseInt(e.availableQty))),d.calculateTotalPrice()},d.showAlertMessage=function(t,e){var a=$("#billingMessagesInfo");__globals.showConfirmation({text:t.message,showConfirmButton:t.showUpdateInventoryButton,confirmButtonText:a.attr("data-confirm-button-text")},function(){d.updateInventory(t.productId,t.name,t.id,null,"1",null,e)})},d.getCalculatedTax=function(e,t,a){var o=0,n=0;return d.billingData.productCombinations[a].tax_details=[],_.isEmpty(t)||_.map(t,function(t){o=0,1==t.type?(o=parseFloat(t.tax_amount),n+=o,d.billingData.productCombinations[a].formattedTax=d.currencySymbol+o):2==t.type&&(o=e*(parseFloat(t.tax_amount)/100),o=parseFloat(o.toFixed(2)),d.billingData.productCombinations[a].formattedTax=parseFloat(t.tax_amount)+"%",n+=o),t.tax_amount_on_product=o.toFixed(2),d.billingData.productCombinations[a].tax_details.push(t)}),d.billingData.productCombinations[a].calculatedTax=n,d.billingData.productCombinations[a].formattedTaxAmount=d.currencySymbol+n,n},d.calculateTotalPrice=function(){var n=[],i=[],r=[],t=(_.forEach(d.billingData.productCombinations,function(t,e){var a,o;_.isUndefined(t.combination.salePrice)||(t=t.combination.salePrice*t.quantity,a=d.billingData.productCombinations[e].taxes,o=0,_.isEmpty(a)||(o=d.getCalculatedTax(t,a,e)),d.billingData.productCombinations[e].price=t,d.billingData.productCombinations[e].formattedPrice=__globals.priceFormat(t.toFixed(2),d.currencySymbol,""),n.push(t),i.push(d.billingData.productCombinations[e].calculatedTax),r.push(t))}),d.subTotal=_.sum(n),d.formattedSubTotal=__globals.priceFormat(d.subTotal,d.currencySymbol,d.currencyCode),d.taxTotalAmount=_.sum(i),d.formattedTaxTotalAmount=__globals.priceFormat(d.taxTotalAmount.toFixed(2),d.currencySymbol,""),d.unitPriceTotal=_.sum(r),d.formattedUnitPriceTotal=__globals.priceFormat(d.unitPriceTotal.toFixed(2),d.currencySymbol,""),0),e=(!d.billingData.is_add_tax||0==d.subTotal||_.isUndefined(d.billingData.tax)||(1==d.billingData.tax_type?t=d.subTotal*d.billingData.tax/100:2==d.billingData.tax_type&&(t=d.billingData.tax)),d.billingData.tax_amount=t,d.billingData.formatted_tax_amount=__globals.priceFormat(t,d.currencySymbol,""),0);d.billingData.is_add_discount&&0!=d.subTotal&&!_.isUndefined(d.billingData.discount)&&(1==d.billingData.discount_type?e=d.subTotal*d.billingData.discount/100:2==d.billingData.discount_type&&(e=d.billingData.discount)),d.billingData.discount_amount=e,d.billingData.formatted_discount_amount=__globals.priceFormat(e,d.currencySymbol,""),d.billingData.totalAmount=d.subTotal+d.taxTotalAmount+t-e,d.formattedSubTotal=__globals.priceFormat(d.subTotal,d.currencySymbol,""),d.formattedTotalAmount=__globals.priceFormat(d.billingData.totalAmount.toFixed(2),d.currencySymbol,"")},d.selectCustomer=function(e){_.isEmpty(d.customerData)||_.forEach(d.customerData,function(t){t.id==e&&(d.billingData.customerDetails=t)})},d.setProductInactive=function(a){_.map(d.billingData.productCombinations,function(t,e){_.includes(a,parseInt(t.combination.productId))&&(d.billingData.productCombinations[e].combination.product_status=2)})},d.submit=function(t){d.billingData.type=t,a.process("manage.billing.write.store_bill",d).success(function(t){_.isEmpty(t.data.inactiveProducts)||d.setProductInactive(t.data.inactiveProducts),l.processResponse(t,null,function(t){1==t&&u.go("billing")})})},d.updateInventory=function(t,e,o,a,n,i,r){l.showDialog({productName:e,productId:t,type:n,combinationId:o,supplierId:i,showProductList:!!_.isEmpty(t)},{templateUrl:"inventory.update-inventory-dialog",controller:"UpdateInventoryController as UpdateInventoryCtrl",resolve:{InventoryUpdateData:function(){return c.getInventoryUpdateData(t,o,a,i)}}},function(t){var a;_.has(t.value,"inventory_updated")&&t.value.inventory_updated&&(a=t.value.stockDetails,_.forEach(d.productData,function(t,e){t.id==o&&(d.productData[e].isQuantityExist=!0,d.productData[e].quantity=a.quantity,d.productData[e].location_id=a.location_id,d.productData[e].availableQty=a.quantity,d.productData[e].location_name=a.location_name,_.defer(function(){d.showProductDetails(o)}))}))})},d.chooseInventryByLocation=function(e,a){l.showDialog({combinationId:e,productId:a.productId},{templateUrl:"billing.combination-location-dialog",controller:"CombinationLocationController as CombinationLocationCtrl",resolve:{CombinationsLocationsData:["InventoryDataService",function(t){return t.getCombinationsLocationwise(e,a.productId)}]}},function(t){_.has(t.value,"location_selected")&&t.value.location_selected&&(t=t.value.location,d.updateProductDetails(a,t))})}}]).controller("CombinationLocationController",["$scope","__DataStore","__Form","$stateParams","CombinationsLocationsData",function(a,t,e,o,n){var i=this,r=(i.productData=n.productData,a.ngDialogData);i.showLocationBtn=!1,i.changeLocation=function(e){_.isEmpty(i.productData.stockByLocations)||_.map(i.productData.stockByLocations,function(t){t.location_id==parseInt(e)&&(i.selected_location=t.location_id,i.showLocationBtn=!1,0<t.quantity&&(i.showLocationBtn=!0))})},i.changeLocation(i.productData.stockByLocations[0].location_id),i.chooseLocation=function(e){_.isUndefined(e)||_.map(i.productData.stockByLocations,function(t){t.location_id==e&&a.closeThisDialog({location_selected:!0,location:t,combinationId:r.combinationId,productId:r.productId})})},i.closeDialog=function(){a.closeThisDialog({location_selected:!1})}}]).controller("BillingEditController",["$scope","__DataStore","__Form","$stateParams","GetEditSupportData","BillingDataService","$compile","__Utils","appServices","InventoryDataService","$state",function(t,e,a,o,n,r,i,s,l,c,u){var d=this,p=(d.productData=[],d.currencyCode=n.currencyCode,d.currencySymbol=n.currencySymbol,(d=a.setup(d,"billing_form","billingData")).billingData.tax_amount=0,d.billingData.formatted_tax_amount=__globals.priceFormat(0,d.currencySymbol,""),d.billingData.discount_amount=0,d.billingData.formatted_discount_amount=__globals.priceFormat(0,d.currencySymbol,""),d.billingData.tax_type="1",d.billingData.discount_type="1",d.dateConfig={minDate:moment().format("YYYY-MM-DD"),time:!1},moment().format("YYYY-MM-DD"));d.billingData.bill_date=p,d.billingData.due_date=p,d.customerSelectConfig=__globals.getSelectizeOptions(),d.combinationSelectConfig=__globals.getSelectizeOptions({valueField:"id",labelField:"name",searchField:["name","comboSKU","barcode","combinationTitle","location_name"],options:[],create:!1,loadThrottle:500,onChange:function(t){this.clearOptions()},onFocus:function(t){this.clearOptions()},render:{option:function(t,e){return i(s.template("#lwSelectizeOp",{item:t}))(d)}},load:function(e,a,t){var o=this,n=$(this)[0].$input[0],i=$(n).data("key");if(!e.length)return a();r.getProductCombinations(e).then(function(t){d.productData=t.productData,_.forEach(d.productData,function(t){t.barcode==e&&(d.showProductDetails(t.id,i),o.blur(),o.clearOptions(),o.focus())}),_.isEmpty(d.productData)&&(o.blur(),o.clearOptions(),o.focus()),a(t.productData)})}}),d.userData=n.userData,d.customerData=n.customerData,d.billingData.customerDetails=null,d.subTotal=0,d.formattedSubTotal=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.billingData.totalAmount=0,d.formattedTotalAmount=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.billingData.is_add_tax=!1,d.billingData.is_add_discount=!1,(d=a.updateModel(d,n.updateData)).deleteStockTransactions=function(t){var a=$("#billTransactionDelete");__globals.showConfirmation({html:a.attr("data-message"),confirmButtonText:a.attr("data-delete-button-text")},function(){e.post({apiURL:"manage.billing.write.delete_transaction",billId:u.params.billUid,transactionId:t}).success(function(t){var e=t.data.message;l.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"})})})})},d.removeItem=function(a,t){var o;t?(o=$("#billTransactionDelete"),__globals.showConfirmation({html:o.attr("data-message"),confirmButtonText:o.attr("data-delete-button-text")},function(){e.post({apiURL:"manage.billing.write.delete_transaction",billId:u.params.billUid,transactionId:t}).success(function(t){var e=t.data.message;l.processResponse(t,{error:function(t){__globals.showConfirmation({title:o.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:o.attr("data-success-text"),text:e,type:"success"}),_.remove(d.billingData.productCombinations,function(t,e){return e==a})})})})):_.remove(d.billingData.productCombinations,function(t,e){return e==a})},d.addNewRow=function(){d.billingData.combination=null,d.billingData.productCombinations.push({combination:[],taxes:[],unit_price:0,formattedUnitPrice:__globals.priceFormat(0,d.currencySymbol,""),quantity:0,price:0,formattedPrice:__globals.priceFormat(0,d.currencySymbol,""),showDetails:!1,isForUpdate:!1,tax_presets__id:null});d.billingData.productCombinations.length},d.isEnterKeyPress=function(t,e){13===(t.which||t.keyCode)&&d.addNewRow()},d.combinationExists=function(a,o){var n=!1;return _.isEmpty(d.billingData.productCombinations)||_.forEach(d.billingData.productCombinations,function(t,e){t.combination.id==a&&o==t.location_id&&(n=!0,d.billingData.productCombinations[e].quantity++,d.calculateTotalPrice())}),n},d.showProductDetails=function(e){var a=[];_.forEach(d.productData,function(t){t.id==e&&(a=t)}),_.isEmpty(a)||(_.isUndefined(a.isQuantityExist)||a.isQuantityExist||d.showAlertMessage(a),a.chooseInventryByLocation&&a.isQuantityExist?d.chooseInventryByLocation(e,a):a.isQuantityExist&&d.updateProductDetails(a))},d.updateProductDetails=function(t,e){var a,o=null;_.isUndefined(e)?(o=t.location_id,d.combinationExists(t.id,o)||(d.addNewRow(),a=d.billingData.productCombinations.length-1,d.billingData.productCombinations[a].showDetails=!1,d.billingData.productCombinations[a].combination=t,d.billingData.productCombinations[a].taxes=t.taxes,d.billingData.productCombinations[a].unit_price=t.salePrice,d.billingData.productCombinations[a].tax_presets__id=t.tax_presets__id,d.billingData.productCombinations[a].formattedUnitPrice=t.formattedSalePrice,d.billingData.productCombinations[a].showDetails=!0,d.billingData.productCombinations[a].quantity=1,d.billingData.productCombinations[a].location_name=t.location_name,d.billingData.productCombinations[a].location_id=t.location_id)):(o=e.location_id,d.combinationExists(t.id,o)||(d.addNewRow(),a=d.billingData.productCombinations.length-1,d.billingData.productCombinations[a].showDetails=!1,d.billingData.productCombinations[a].combination=t,d.billingData.productCombinations[a].taxes=t.taxes,d.billingData.productCombinations[a].unit_price=t.salePrice,d.billingData.productCombinations[a].tax_presets__id=t.tax_presets__id,d.billingData.productCombinations[a].formattedUnitPrice=t.formattedSalePrice,d.billingData.productCombinations[a].showDetails=!0,d.billingData.productCombinations[a].quantity=1,d.billingData.productCombinations[a].location_name=t.location_name,d.billingData.productCombinations[a].location_id=e.location_id,d.billingData.productCombinations[a].location_name=e.location,d.billingData.productCombinations[a].combination.quantity=parseInt(e.quantity),d.billingData.productCombinations[a].combination.lockQuantity=parseInt(e.lockQuantity),d.billingData.productCombinations[a].combination.availableQty=parseInt(e.availableQty))),d.calculateTotalPrice()},d.showAlertMessage=function(t){var e=$("#billingMessagesInfo");__globals.showConfirmation({text:t.message,showConfirmButton:t.showUpdateInventoryButton,confirmButtonText:e.attr("data-confirm-button-text")},function(){d.updateInventory(t.productId,t.name,t.id,null,"1",null)})},d.getCalculatedTax=function(e,t,a){var o=0,n=0;return d.billingData.productCombinations[a].tax_details=[],_.isEmpty(t)||_.map(t,function(t){o=0,1==t.type?(o=parseFloat(t.tax_amount),n+=o,d.billingData.productCombinations[a].formattedTax=d.currencySymbol+o):2==t.type&&(o=e*(parseFloat(t.tax_amount)/100),o=parseFloat(o),d.billingData.productCombinations[a].formattedTax=parseFloat(t.tax_amount).toFixed(2)+"%",n+=o),t.tax_amount_on_product=o.toFixed(2),d.billingData.productCombinations[a].tax_details.push(t)}),d.billingData.productCombinations[a].calculatedTax=n,d.billingData.productCombinations[a].formattedTaxAmount=d.currencySymbol+n,n},d.calculateTotalPrice=function(){var n=[],i=[],r=[],t=(_.forEach(d.billingData.productCombinations,function(t,e){var a,o;_.isUndefined(t.combination.salePrice)||(t=t.combination.salePrice*t.quantity,a=d.billingData.productCombinations[e].taxes,o=0,_.isEmpty(a)||(o=d.getCalculatedTax(t,a,e)),d.billingData.productCombinations[e].price=t,d.billingData.productCombinations[e].formattedPrice=__globals.priceFormat(t.toFixed(2),d.currencySymbol,""),n.push(t),i.push(d.billingData.productCombinations[e].calculatedTax),r.push(t))}),d.subTotal=_.sum(n),d.formattedSubTotal=__globals.priceFormat(d.subTotal,d.currencySymbol,d.currencyCode),d.taxTotalAmount=_.sum(i),d.formattedTaxTotalAmount=__globals.priceFormat(d.taxTotalAmount.toFixed(2),d.currencySymbol,""),d.unitPriceTotal=_.sum(r),d.formattedUnitPriceTotal=__globals.priceFormat(d.unitPriceTotal.toFixed(2),d.currencySymbol,""),0),e=(!d.billingData.is_add_tax||0==d.subTotal||_.isUndefined(d.billingData.tax)||(1==d.billingData.tax_type?t=d.subTotal*d.billingData.tax/100:2==d.billingData.tax_type&&(t=d.billingData.tax)),d.billingData.tax_amount=t,d.billingData.formatted_tax_amount=__globals.priceFormat(t,d.currencySymbol,""),0);d.billingData.is_add_discount&&0!=d.subTotal&&!_.isUndefined(d.billingData.discount)&&(1==d.billingData.discount_type?e=d.subTotal*d.billingData.discount/100:2==d.billingData.discount_type&&(e=d.billingData.discount)),d.billingData.discount_amount=e,d.billingData.formatted_discount_amount=__globals.priceFormat(e,d.currencySymbol,""),d.billingData.totalAmount=d.subTotal+d.taxTotalAmount+t-e,d.formattedSubTotal=__globals.priceFormat(d.subTotal,d.currencySymbol,""),d.formattedTotalAmount=__globals.priceFormat(d.billingData.totalAmount.toFixed(2),d.currencySymbol,"")},d.calculateTotalPrice(),d.selectCustomer=function(e){_.isEmpty(d.customerData)||_.forEach(d.customerData,function(t){t.id==e&&(d.billingData.customerDetails=t)})},d.selectCustomer(n.updateData.customer),d.setProductInactive=function(a){_.map(d.billingData.productCombinations,function(t,e){_.includes(a,parseInt(t.combination.productId))&&(d.billingData.productCombinations[e].combination.product_status=2)})},d.update=function(t){d.billingData.type=t,a.process({apiURL:"manage.billing.write.update_bill",billId:o.billUid},d).success(function(t){_.isEmpty(t.data.inactiveProducts)||d.setProductInactive(t.data.inactiveProducts),l.processResponse(t,null,function(t){1==t&&u.go("billing")})})},d.updateInventory=function(t,e,o,a,n,i){l.showDialog({productName:e,productId:t,type:n,combinationId:o,supplierId:i,showProductList:!!_.isEmpty(t)},{templateUrl:"inventory.update-inventory-dialog",controller:"UpdateInventoryController as UpdateInventoryCtrl",resolve:{InventoryUpdateData:function(){return c.getInventoryUpdateData(t,o,a,i)}}},function(t){var a;_.has(t.value,"inventory_updated")&&t.value.inventory_updated&&(a=t.value.stockDetails,_.forEach(d.productData,function(t,e){t.id==o&&(d.productData[e].isQuantityExist=!0,d.productData[e].quantity=a.quantity,d.productData[e].location_id=a.location_id,d.productData[e].availableQty=a.quantity,d.productData[e].location_name=a.location_name,_.defer(function(){d.showProductDetails(o)}))}))})},d.chooseInventryByLocation=function(e,a){l.showDialog({combinationId:e,productId:a.productId},{templateUrl:"billing.combination-location-dialog",controller:"CombinationLocationController as CombinationLocationCtrl",resolve:{CombinationsLocationsData:["InventoryDataService",function(t){return t.getCombinationsLocationwise(e,a.productId)}]}},function(t){_.has(t.value,"location_selected")&&t.value.location_selected&&(t=t.value.location,d.updateProductDetails(a,t))})}}]).controller("BillingDetailsController",["$scope","__DataStore","__Form","$stateParams","GetEditSupportData","BillingDataService","$compile","__Utils","appServices","InventoryDataService","$state",function(t,e,a,o,n,i,r,s,l,c,u){var d=this;d.productData=[],d.currencyCode=n.currencyCode,d.currencySymbol=n.currencySymbol,(d=a.setup(d,"billing_form","billingData")).billingData.tax_amount=0,d.billingData.formatted_tax_amount=__globals.priceFormat(0,d.currencySymbol,""),d.billingData.discount_amount=0,d.billingData.formatted_discount_amount=__globals.priceFormat(0,d.currencySymbol,""),d.billingData.tax_type="1",d.billingData.discount_type="1",d.userData=n.userData,d.customerData=n.customerData,d.billingData.customerDetails=null,d.subTotal=0,d.formattedSubTotal=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.billingData.totalAmount=0,d.formattedTotalAmount=__globals.priceFormat(0,d.currencySymbol,d.currencyCode),d.billingData.is_add_tax=!1,d.billingData.is_add_discount=!1,(d=a.updateModel(d,n.updateData)).downloadPdfUrl=s.apiURL({apiURL:"manage.billing.read.download_pdf",billId:o.billUid}),d.printUrl=s.apiURL({apiURL:"manage.billing.read.print_bill",billId:o.billUid}),d.getCalculatedTax=function(e,t,a){var o=0,n=0;return d.billingData.productCombinations[a].tax_details=[],_.isEmpty(t)||_.map(t,function(t){o=0,1==t.type?(o=parseFloat(t.tax_amount),n+=o,d.billingData.productCombinations[a].formattedTax=d.currencySymbol+o):2==t.type&&(o=e*(parseFloat(t.tax_amount)/100),o=parseFloat(o.toFixed(2)),d.billingData.productCombinations[a].formattedTax=parseFloat(t.tax_amount)+"%",n+=o),t.tax_amount_on_product=o.toFixed(2),d.billingData.productCombinations[a].tax_details.push(t)}),d.billingData.productCombinations[a].calculatedTax=n,d.billingData.productCombinations[a].formattedTaxAmount=d.currencySymbol+n,n},d.calculateTotalPrice=function(){var n=[],i=[],r=[],t=(_.forEach(d.billingData.productCombinations,function(t,e){var a,o;_.isUndefined(t.combination.salePrice)||(t=t.combination.salePrice*t.quantity,a=d.billingData.productCombinations[e].taxes,o=0,_.isEmpty(a)||(o=d.getCalculatedTax(t,a,e)),d.billingData.productCombinations[e].price=t,d.billingData.productCombinations[e].formattedPrice=__globals.priceFormat(t.toFixed(2),d.currencySymbol,""),n.push(t),i.push(d.billingData.productCombinations[e].calculatedTax),r.push(t))}),d.subTotal=_.sum(n),d.formattedSubTotal=__globals.priceFormat(d.subTotal,d.currencySymbol,d.currencyCode),d.taxTotalAmount=_.sum(i),d.formattedTaxTotalAmount=__globals.priceFormat(d.taxTotalAmount.toFixed(2),d.currencySymbol,""),d.unitPriceTotal=_.sum(r),d.formattedUnitPriceTotal=__globals.priceFormat(d.unitPriceTotal.toFixed(2),d.currencySymbol,""),0),e=(0==d.subTotal||_.isUndefined(d.billingData.tax)||(1==d.billingData.tax_type?t=d.subTotal*d.billingData.tax/100:2==d.billingData.tax_type&&(t=d.billingData.tax)),d.billingData.tax_amount=t,d.billingData.formatted_tax_amount=__globals.priceFormat(t,d.currencySymbol,""),0);0==d.subTotal||_.isUndefined(d.billingData.discount)||(1==d.billingData.discount_type?e=d.subTotal*d.billingData.discount/100:2==d.billingData.discount_type&&(e=d.billingData.discount)),d.billingData.discount_amount=e,d.billingData.formatted_discount_amount=__globals.priceFormat(e,d.currencySymbol,""),d.billingData.totalAmount=d.subTotal+d.taxTotalAmount+t-e,d.formattedSubTotal=__globals.priceFormat(d.subTotal,d.currencySymbol,""),d.formattedTotalAmount=__globals.priceFormat(d.billingData.totalAmount.toFixed(2),d.currencySymbol,"")},d.calculateTotalPrice(),d.selectCustomer=function(e){_.isEmpty(d.customerData)||_.forEach(d.customerData,function(t){t.id==e&&(d.billingData.customerDetails=t)})},d.selectCustomer(n.updateData.customer)}])}(window),function(){"use strict";window.angular.module("app.TaxPresetDataServices",[]).service("TaxPresetDataService",["$q","__DataStore","appServices",function(e,o,n){this.getAddSupportData=function(){var a=e.defer();return o.fetch("manage.tax_preset.read.support_data").success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getEditSupportData=function(t){var a=e.defer();return o.fetch({apiURL:"manage.tax_preset.read.update.data",taxPresetIdOrUid:t}).success(function(e){n.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.TaxPresetEngine",[]).controller("TaxPresetController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("TaxpresetListController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","TaxPresetDataService",function(t,o,e,a,n,i,r){var s=this;s.taxPresetDataTable=o.dataTable("#lwtaxpresetList",{url:"manage.tax_preset.read.list",dtOptions:{searching:!0},columnsData:[{name:"title",orderable:!0,template:"#titleColumnTemplate"},{name:"short_description"},{name:"formatted_status",orderable:!1},{name:null,template:"#taxpresetActionColumnTemplate"}],scope:t}),s.reloadDT=function(){o.reloadDT(s.taxPresetDataTable)},t.$on("taxpreset_added_or_updated",function(t){t&&s.reloadDT()}),s.delete=function(t,e){var a=$("#taxpresetDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.tax_preset.write.delete",taxPresetIdOrUid:t}).success(function(t){var e=t.data.message;n.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),s.reloadDT()})})})},s.openAddDialog=function(){n.showDialog(s,{templateUrl:__globals.getTemplateURL("tax-preset.add-dialog"),controller:"TaxpresetAddController as taxpresetAddCtrl",resolve:{taxPresetAddData:function(){return r.getAddSupportData()}}},function(t){_.has(t.value,"taxpreset_added_or_updated")&&t.value.taxpreset_added_or_updated&&s.reloadDT()})},s.openEditDialog=function(t){n.showDialog({taxPresetIdOrUid:t},{templateUrl:__globals.getTemplateURL("tax-preset.edit-dialog"),controller:"TaxpresetEditController as taxpresetEditCtrl",resolve:{taxPresetEditData:function(){return r.getEditSupportData(t)}}},function(t){_.has(t.value,"taxpreset_added_or_updated")&&t.value.taxpreset_added_or_updated&&s.reloadDT()})}}]).controller("TaxpresetAddController",["$scope","__DataStore","__Form","$state","appServices","$rootScope",function(e,t,a,o,n,i){var r=this;r.showLoader=!0,(r=a.setup(r,"taxpreset_form","taxpresetData",{secured:!0,unsecuredFields:[]})).taxpresetData.status=!0,r.submit=function(){a.process("manage.tax_preset.write.create",r).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({taxpreset_added_or_updated:!0})})})},r.closeDialog=function(){e.closeThisDialog()}}]).controller("TaxpresetEditController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","taxPresetEditData",function(e,t,a,o,n,i,r){var s=this,l=(s.showLoader=!0,s=a.setup(s,"taxpreset_form","taxpresetData",{secured:!0,unsecuredFields:[]}),(s=a.updateModel(s,r)).showLoader=!1,e.ngDialogData.taxPresetIdOrUid);s.submit=function(){a.process({apiURL:"manage.tax_preset.write.update",taxPresetIdOrUid:l},s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({taxpreset_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}])}(window),function(){"use strict";window.angular.module("app.TaxDataServices",[]).service("TaxDataService",["$q","__DataStore","appServices",function(o,n,i){this.getAddSupportData=function(t){var a=o.defer();return n.fetch({apiURL:"manage.tax.read.support_data",taxPresetIdOrUid:t}).success(function(e){i.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise},this.getEditSupportData=function(t,e){var a=o.defer();return n.fetch({apiURL:"manage.tax.read.update.data",taxIdOrUid:t,taxPresetIdOrUid:e}).success(function(e){i.processResponse(e,null,function(t){a.resolve(e.data)})}),a.promise}}])}(window),function(){"use strict";window.angular.module("app.TaxEngine",[]).controller("TaxController",["$scope","__DataStore","__Form","$stateParams",function(t,e,a,o){}]).controller("TaxListController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","TaxDataService",function(t,o,e,n,i,a,r){var s=this;s.taxDataTable=o.dataTable("#lwTaxList",{url:{apiURL:"manage.tax.read.list",taxPresetIdOrUid:n.params.taxPresetIdOrUid},dtOptions:{searching:!0},columnsData:[{name:"title",orderable:!0},{name:"formatted_type",orderable:!1},{name:"formatted_status",orderable:!1},{name:"tax_amount",orderable:!0},{name:null,template:"#taxActionColumnTemplate"}],scope:t}),s.reloadDT=function(){o.reloadDT(s.taxDataTable)},t.$on("tax_added_or_updated",function(t){t&&s.reloadDT()}),s.delete=function(t,e){var a=$("#taxpresetDeleteConfirm");__globals.showConfirmation({html:__globals.getReplacedString(a,"__name__",_.unescape(e)),confirmButtonText:a.attr("data-delete-button-text")},function(){o.post({apiURL:"manage.tax.write.delete",taxIdOrUid:t,taxPresetIdOrUid:n.params.taxPresetIdOrUid}).success(function(t){var e=t.data.message;i.processResponse(t,{error:function(t){__globals.showConfirmation({title:a.attr("data-error-text"),text:e,type:"error"})}},function(t){__globals.showConfirmation({title:a.attr("data-success-text"),text:e,type:"success"}),s.reloadDT()})})})},s.openAddDialog=function(){i.showDialog(s,{templateUrl:__globals.getTemplateURL("tax.add-dialog"),controller:"TaxAddController as taxAddCtrl",resolve:{TaxAddData:["TaxDataService",function(t){return t.getAddSupportData(n.params.taxPresetIdOrUid)}]}},function(t){_.has(t.value,"tax_added_or_updated")&&t.value.tax_added_or_updated&&s.reloadDT()})},s.openEditDialog=function(e){i.showDialog({taxIdOrUid:e},{templateUrl:__globals.getTemplateURL("tax.edit-dialog"),controller:"TaxEditController as taxEditCtrl",resolve:{TaxEditData:["TaxDataService",function(t){return t.getEditSupportData(e,n.params.taxPresetIdOrUid)}]}},function(t){_.has(t.value,"tax_added_or_updated")&&t.value.tax_added_or_updated&&s.reloadDT()})}}]).controller("TaxAddController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","TaxAddData",function(e,t,a,o,n,i,r){var s=this;s.showLoader=!0,(s=a.setup(s,"tax_form","taxData",{secured:!0,unsecuredFields:[]})).taxTypes=__globals.generateKeyValueItems(r.tax_types),s.taxTypeSelectize=__globals.getSelectizeOptions(),s.taxData.status=!0,s.submit=function(){a.process({apiURL:"manage.tax.write.create",taxPresetIdOrUid:o.params.taxPresetIdOrUid},s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({tax_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}]).controller("TaxEditController",["$scope","__DataStore","__Form","$state","appServices","$rootScope","TaxEditData",function(e,t,a,o,n,i,r){var s=this,l=(s.showLoader=!0,s=a.setup(s,"tax_form","taxData",{secured:!0,unsecuredFields:[]}),(s=a.updateModel(s,r.updateData)).showLoader=!1,e.ngDialogData.taxIdOrUid);s.taxTypes=__globals.generateKeyValueItems(r.tax_types),s.taxTypeSelectize=__globals.getSelectizeOptions(),s.submit=function(){a.process({apiURL:"manage.tax.write.update",taxIdOrUid:l,taxPresetIdOrUid:o.params.taxPresetIdOrUid},s).success(function(t){n.processResponse(t,null,function(){e.closeThisDialog({tax_added_or_updated:!0})})})},s.closeDialog=function(){e.closeThisDialog()}}])}(window);